{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "id": "4nL2i6ddqrNK"
   },
   "outputs": [],
   "source": [
    "\n",
    "api_key=\"your mistral api key here \"\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "***Go to This website for mistral api***\n",
    "### https://console.mistral.ai/api-keys/ ###"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "2W0avHn01vSc",
    "outputId": "0bd8ae99-b4ae-43aa-d586-0718ca3cac79"
   },
   "outputs": [],
   "source": [
    "# Install required packages for the RAG QA system:\n",
    "\n",
    "# LangChain integration with Mistral AI\n",
    "%pip install langchain-mistralai\n",
    "\n",
    "# Core LangChain community packages and HTML parser\n",
    "%pip install -qU langchain_community beautifulsoup4\n",
    "\n",
    "# Main LangChain framework\n",
    "%pip install langchain\n",
    "\n",
    "# For generating text embeddings\n",
    "%pip install sentence-transformers\n",
    "\n",
    "# Vector store for document embeddings\n",
    "%pip install langchain-chroma\n",
    "\n",
    "# PDF processing and LangChain community tools\n",
    "%pip install -qU langchain_community pypdf"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {
    "id": "S1IGzS-8cFmT"
   },
   "outputs": [],
   "source": [
    "# from langchain_community.document_loaders import WebBaseLoader\n",
    "\n",
    "# # List of URLs to load content from\n",
    "# urls = [\n",
    "#     \"https://lucidmotors.com/\",\n",
    "#     \"https://lucidmotors.com/referral-program\",\n",
    "#     \"https://lucidmotors.com/gravity\",\n",
    "#     \"https://lucidmotors.com/company\",\n",
    "#     \"https://lucidmotors.com/sustainability\",\n",
    "#     \"https://lucidmotors.com/careers\"# Add more URLs as needed\n",
    "# ]\n",
    "\n",
    "# # Load content from multiple URLs\n",
    "# Lucid_loader = []\n",
    "# for url in urls:\n",
    "#     loader = WebBaseLoader(url)\n",
    "#     Lucid_loader.extend(loader.load())\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "1E_YmIV8w3U3",
    "outputId": "89c807a7-303e-42a0-95ec-31b035d5e3f1"
   },
   "outputs": [],
   "source": [
    "# Import the PDF loader from langchain community package\n",
    "from langchain_community.document_loaders import PyPDFLoader\n",
    "\n",
    "# Initialize PDF loader with path to Lucid Motors sustainability report\n",
    "# This loader will help us extract text content from the PDF document\n",
    "loader = PyPDFLoader(\n",
    "    r\"/Users/innovapathinc/Desktop/Gen Ai Topics /Retrieval_eval/ML_GenAI_Concepts/RAG/Data/Medical_book.pdf\"\n",
    ")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Load and parse the PDF document using the initialized loader\n",
    "# This returns a list of Document objects containing the text content\n",
    "docs = loader.load()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {
    "id": "tlmq68c7cbji"
   },
   "outputs": [],
   "source": [
    "# Import the text splitter for chunking documents\n",
    "from langchain.text_splitter import CharacterTextSplitter\n",
    "\n",
    "# Create a text splitter that will break documents into chunks\n",
    "# - Uses double newlines as chunk boundaries\n",
    "# - Creates chunks of 500 characters\n",
    "# - Allows 150 character overlap between chunks to maintain context\n",
    "# - Treats separator as literal string, not regex pattern\n",
    "text_splitter = CharacterTextSplitter(\n",
    "\tseparator=\"\\n\\n\",\n",
    "\tchunk_size=500,\n",
    "\tchunk_overlap=150,\n",
    "\tis_separator_regex=False,)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "7uL_xIk_dNC5",
    "outputId": "85cf91d1-d883-41b9-bd9d-6c863acc8e37"
   },
   "outputs": [],
   "source": [
    "# Split the loaded documents into smaller chunks using the configured text splitter\n",
    "# This creates overlapping chunks that maintain context while being small enough\n",
    "# for efficient processing and embedding\n",
    "chunks = text_splitter.split_documents(docs)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "9v-kRuHaoyrp",
    "outputId": "5df753a6-600b-4968-c7be-86f288d34e62"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "print tags=['Chroma', 'CacheBackedEmbeddings'] vectorstore=<langchain_community.vectorstores.chroma.Chroma object at 0x34109ea80> search_kwargs={}\n"
     ]
    }
   ],
   "source": [
    "\n",
    "# Import HuggingFaceEmbeddings for generating text embeddings\n",
    "from langchain.embeddings import HuggingFaceEmbeddings\n",
    "# Import CacheBackedEmbeddings to enable caching of embeddings for better performance\n",
    "from langchain.embeddings.cache import CacheBackedEmbeddings\n",
    "# Import Chroma vector store for storing and retrieving embeddings\n",
    "from langchain.vectorstores import Chroma\n",
    "# Import LocalFileStore for storing embeddings cache on disk\n",
    "from langchain.storage import LocalFileStore\n",
    "\n",
    "# Set up the cache store\n",
    "store = LocalFileStore(\"./cache/\")\n",
    "\n",
    "# Initialize the Hugging Face embedding model\n",
    "core_embeddings_model = HuggingFaceEmbeddings(model_name=\"sentence-transformers/all-MiniLM-L6-v2\")\n",
    "\n",
    "# Use the cache-backed embedder with the Hugging Face model\n",
    "embedder = CacheBackedEmbeddings.from_bytes_store(\n",
    "    core_embeddings_model,\n",
    "    store,\n",
    "    namespace=core_embeddings_model.model_name\n",
    ")\n",
    "\n",
    "# Store embeddings in the Chroma vector store\n",
    "vectorstore = Chroma.from_documents(chunks, embedder, persist_directory=\"./chroma_store\")\n",
    "\n",
    "# Instantiate a retriever from the vector store\n",
    "retriever = vectorstore.as_retriever()\n",
    "print(\"print\",retriever)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {
    "id": "sBhjCMuVp10c"
   },
   "outputs": [],
   "source": [
    "# Import required modules from langchain\n",
    "from langchain_mistralai import ChatMistralAI  # For using Mistral AI chat model\n",
    "from langchain_core.prompts import ChatPromptTemplate  # For creating chat prompt templates\n",
    "from langchain_core.runnables import RunnablePassthrough, RunnableParallel  # For creating processing chains\n",
    "\n",
    "# Helper function to format retrieved documents into a single string\n",
    "# Takes a list of documents and joins their content with double newlines\n",
    "def format_docs(docs):\n",
    "\treturn \"\\n\\n\".join(doc.page_content for doc in docs)\n",
    "\n",
    "# Define the system prompt for the question-answering task\n",
    "# This prompt instructs the model on how to process the context and answer questions\n",
    "prompt = \"\"\"You are an assistant for question-answering tasks.\n",
    "    \tUse the following pieces of retrieved context to answer the question.\n",
    "    \tIf you don't know the answer, just say that you don't know.\n",
    "    \tUse three sentences maximum and keep the answer concise.\n",
    "\n",
    "    \tQuestion: {question}\n",
    "\n",
    "    \tContext: {context}\n",
    "\n",
    "    \tAnswer:\n",
    "    \t\"\"\"\n",
    "\n",
    "# Create a chat prompt template from the defined prompt string\n",
    "prompt_template = ChatPromptTemplate.from_template(prompt)\n",
    "\n",
    "# Initialize the Mistral AI chat model with specified parameters\n",
    "# Using mistral-large-latest model with streaming enabled\n",
    "llm = ChatMistralAI(\n",
    "    model=\"mistral-large-latest\", streaming=True, api_key=api_key)\n",
    "\n",
    "# Create the main RAG processing chain for handling documents\n",
    "# This chain:\n",
    "# 1. Takes input documents and formats them using format_docs()\n",
    "# 2. Passes the formatted context through the prompt template\n",
    "# 3. Sends the resulting prompt to the LLM for processing\n",
    "rag_chain_from_docs = (\n",
    "\tRunnablePassthrough.assign(context=(lambda x: format_docs(x[\"context\"])))\n",
    "\t| prompt_template\n",
    "\t| llm\n",
    "\t)\n",
    "\n",
    "# Create the final RAG chain that combines retrieval and processing\n",
    "# This chain:\n",
    "# 1. Retrieves relevant context using the retriever\n",
    "# 2. Passes the original question unchanged\n",
    "# 3. Combines both and processes them using rag_chain_from_docs\n",
    "rag_chain_with_source = RunnableParallel(\n",
    "\t{\"context\": retriever, \"question\": RunnablePassthrough()}\n",
    ").assign(answer=rag_chain_from_docs)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "uaWUiIXDrf7p",
    "outputId": "fa42b22b-0576-4753-ef93-496e4f5dc72a"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Arthroscopic surgery, also called arthroscopy, is a minimally invasive procedure performed in a hospital or outpatient surgical facility. It involves inserting instruments through small incisions to treat various joint problems such as arthritis. It is widely used and most patients are released the same day.\n",
      "[Document(metadata={'page': 376, 'source': './Medical_book.pdf'}, page_content='Corrective arthroscopic surgery is performed with\\ninstruments that are inserted through additional inci-\\nsions. Arthritis can sometimes be treated with arthro-\\nscopic surgery. Some problems are treated with a combi-\\nnation of arthroscopic and standard surgery.\\nAlso called arthroscopy , the procedure is per-\\nformed in a hospital or outpatient surgical facility. The\\ntype of anesthesia (local, spinal, or general) and the\\nlength of the procedure depends on the joint operated on\\nand the complexity of the suspected problem. Arthro-\\nscopic surgery rarely takes more than an hour. Most\\npatients who have arthroscopic surgery are released that\\nsame day; some patients stay in the hospital overnight.\\nConsidered the most important orthopedic develop-\\nment in the 20th century, arthroscopic surgery is widely\\nused. The use of arthroscopic surgery on famous athletes\\nhas been well publicized. It is estimated that 80% of\\northopedic surgeons practice arthroscopic surgery.\\nArthroscopic surgery was initially a diagnostic tool used\\nprior to open surgery, but as better instruments and tech-\\nniques were developed, it began to be used to actually\\ntreat a variety of joint problems. New techniques current-\\nly under development are likely to lead to other joints\\nbeing treated with arthroscopic surgery in the future.\\nRecently, lasers were introduced in arthroscopic surgery\\nand other new energy sources are being explored. Lasers\\nand electromagnetic radiation can repair rather than resect\\ninjuries and may be more cost effective than instruments.\\nPreparation\\nBefore the procedure, blood and urine studies and x\\nrays of the joint will be conducted.\\nAftercare\\nImmediately after the procedure, the patient will\\nspend several hours in the recovery room. An ice pack\\nwill be put on the joint that was operated on for up to 48\\nhours after the procedure. Pain medicine, prescription or\\nnon-prescription, will be given. The morning after the\\nsurgery, the dressing can be removed and replaced by\\nadhesive strips. The patient should call his/her doctor\\nupon experiencing an increase in pain, swelling, redness,\\ndrainage or bleeding at the site of the surgery, signs of\\ninfection (headache, muscle aches, dizziness, fever), or\\nnausea or vomiting.\\nGALE ENCYCLOPEDIA OF MEDICINE 2 363\\nArthroscopic surgery\\nCamera\\nTelescope\\nAn arthroscope uses optical fibers to form an image of the damged cartilage, which it sends to a television monitor that\\nhelps the surgeon perform surgery.(Illustration by Argosy Inc.)\\nGEM - 0001 to 0432 - A  10/22/03 1:42 PM  Page 363'), Document(metadata={'page': 376, 'source': './Medical_book.pdf'}, page_content='Corrective arthroscopic surgery is performed with\\ninstruments that are inserted through additional inci-\\nsions. Arthritis can sometimes be treated with arthro-\\nscopic surgery. Some problems are treated with a combi-\\nnation of arthroscopic and standard surgery.\\nAlso called arthroscopy , the procedure is per-\\nformed in a hospital or outpatient surgical facility. The\\ntype of anesthesia (local, spinal, or general) and the\\nlength of the procedure depends on the joint operated on\\nand the complexity of the suspected problem. Arthro-\\nscopic surgery rarely takes more than an hour. Most\\npatients who have arthroscopic surgery are released that\\nsame day; some patients stay in the hospital overnight.\\nConsidered the most important orthopedic develop-\\nment in the 20th century, arthroscopic surgery is widely\\nused. The use of arthroscopic surgery on famous athletes\\nhas been well publicized. It is estimated that 80% of\\northopedic surgeons practice arthroscopic surgery.\\nArthroscopic surgery was initially a diagnostic tool used\\nprior to open surgery, but as better instruments and tech-\\nniques were developed, it began to be used to actually\\ntreat a variety of joint problems. New techniques current-\\nly under development are likely to lead to other joints\\nbeing treated with arthroscopic surgery in the future.\\nRecently, lasers were introduced in arthroscopic surgery\\nand other new energy sources are being explored. Lasers\\nand electromagnetic radiation can repair rather than resect\\ninjuries and may be more cost effective than instruments.\\nPreparation\\nBefore the procedure, blood and urine studies and x\\nrays of the joint will be conducted.\\nAftercare\\nImmediately after the procedure, the patient will\\nspend several hours in the recovery room. An ice pack\\nwill be put on the joint that was operated on for up to 48\\nhours after the procedure. Pain medicine, prescription or\\nnon-prescription, will be given. The morning after the\\nsurgery, the dressing can be removed and replaced by\\nadhesive strips. The patient should call his/her doctor\\nupon experiencing an increase in pain, swelling, redness,\\ndrainage or bleeding at the site of the surgery, signs of\\ninfection (headache, muscle aches, dizziness, fever), or\\nnausea or vomiting.\\nGALE ENCYCLOPEDIA OF MEDICINE 2 363\\nArthroscopic surgery\\nCamera\\nTelescope\\nAn arthroscope uses optical fibers to form an image of the damged cartilage, which it sends to a television monitor that\\nhelps the surgeon perform surgery.(Illustration by Argosy Inc.)\\nGEM - 0001 to 0432 - A  10/22/03 1:42 PM  Page 363'), Document(metadata={'page': 376, 'source': '/Users/innovapathinc/Desktop/Gen Ai Topics /Retrieval_eval/ML_GenAI_Concepts/RAG/Data/Medical_book.pdf'}, page_content='Corrective arthroscopic surgery is performed with\\ninstruments that are inserted through additional inci-\\nsions. Arthritis can sometimes be treated with arthro-\\nscopic surgery. Some problems are treated with a combi-\\nnation of arthroscopic and standard surgery.\\nAlso called arthroscopy , the procedure is per-\\nformed in a hospital or outpatient surgical facility. The\\ntype of anesthesia (local, spinal, or general) and the\\nlength of the procedure depends on the joint operated on\\nand the complexity of the suspected problem. Arthro-\\nscopic surgery rarely takes more than an hour. Most\\npatients who have arthroscopic surgery are released that\\nsame day; some patients stay in the hospital overnight.\\nConsidered the most important orthopedic develop-\\nment in the 20th century, arthroscopic surgery is widely\\nused. The use of arthroscopic surgery on famous athletes\\nhas been well publicized. It is estimated that 80% of\\northopedic surgeons practice arthroscopic surgery.\\nArthroscopic surgery was initially a diagnostic tool used\\nprior to open surgery, but as better instruments and tech-\\nniques were developed, it began to be used to actually\\ntreat a variety of joint problems. New techniques current-\\nly under development are likely to lead to other joints\\nbeing treated with arthroscopic surgery in the future.\\nRecently, lasers were introduced in arthroscopic surgery\\nand other new energy sources are being explored. Lasers\\nand electromagnetic radiation can repair rather than resect\\ninjuries and may be more cost effective than instruments.\\nPreparation\\nBefore the procedure, blood and urine studies and x\\nrays of the joint will be conducted.\\nAftercare\\nImmediately after the procedure, the patient will\\nspend several hours in the recovery room. An ice pack\\nwill be put on the joint that was operated on for up to 48\\nhours after the procedure. Pain medicine, prescription or\\nnon-prescription, will be given. The morning after the\\nsurgery, the dressing can be removed and replaced by\\nadhesive strips. The patient should call his/her doctor\\nupon experiencing an increase in pain, swelling, redness,\\ndrainage or bleeding at the site of the surgery, signs of\\ninfection (headache, muscle aches, dizziness, fever), or\\nnausea or vomiting.\\nGALE ENCYCLOPEDIA OF MEDICINE 2 363\\nArthroscopic surgery\\nCamera\\nTelescope\\nAn arthroscope uses optical fibers to form an image of the damged cartilage, which it sends to a television monitor that\\nhelps the surgeon perform surgery.(Illustration by Argosy Inc.)\\nGEM - 0001 to 0432 - A  10/22/03 1:42 PM  Page 363'), Document(metadata={'page': 376, 'source': '/Users/innovapathinc/Desktop/Gen Ai Topics /Retrieval_eval/ML_GenAI_Concepts/RAG/Data/Medical_book.pdf'}, page_content='Corrective arthroscopic surgery is performed with\\ninstruments that are inserted through additional inci-\\nsions. Arthritis can sometimes be treated with arthro-\\nscopic surgery. Some problems are treated with a combi-\\nnation of arthroscopic and standard surgery.\\nAlso called arthroscopy , the procedure is per-\\nformed in a hospital or outpatient surgical facility. The\\ntype of anesthesia (local, spinal, or general) and the\\nlength of the procedure depends on the joint operated on\\nand the complexity of the suspected problem. Arthro-\\nscopic surgery rarely takes more than an hour. Most\\npatients who have arthroscopic surgery are released that\\nsame day; some patients stay in the hospital overnight.\\nConsidered the most important orthopedic develop-\\nment in the 20th century, arthroscopic surgery is widely\\nused. The use of arthroscopic surgery on famous athletes\\nhas been well publicized. It is estimated that 80% of\\northopedic surgeons practice arthroscopic surgery.\\nArthroscopic surgery was initially a diagnostic tool used\\nprior to open surgery, but as better instruments and tech-\\nniques were developed, it began to be used to actually\\ntreat a variety of joint problems. New techniques current-\\nly under development are likely to lead to other joints\\nbeing treated with arthroscopic surgery in the future.\\nRecently, lasers were introduced in arthroscopic surgery\\nand other new energy sources are being explored. Lasers\\nand electromagnetic radiation can repair rather than resect\\ninjuries and may be more cost effective than instruments.\\nPreparation\\nBefore the procedure, blood and urine studies and x\\nrays of the joint will be conducted.\\nAftercare\\nImmediately after the procedure, the patient will\\nspend several hours in the recovery room. An ice pack\\nwill be put on the joint that was operated on for up to 48\\nhours after the procedure. Pain medicine, prescription or\\nnon-prescription, will be given. The morning after the\\nsurgery, the dressing can be removed and replaced by\\nadhesive strips. The patient should call his/her doctor\\nupon experiencing an increase in pain, swelling, redness,\\ndrainage or bleeding at the site of the surgery, signs of\\ninfection (headache, muscle aches, dizziness, fever), or\\nnausea or vomiting.\\nGALE ENCYCLOPEDIA OF MEDICINE 2 363\\nArthroscopic surgery\\nCamera\\nTelescope\\nAn arthroscope uses optical fibers to form an image of the damged cartilage, which it sends to a television monitor that\\nhelps the surgeon perform surgery.(Illustration by Argosy Inc.)\\nGEM - 0001 to 0432 - A  10/22/03 1:42 PM  Page 363')]\n"
     ]
    }
   ],
   "source": [
    "\n",
    "# Query the RAG system about Lucid's car types\n",
    "response = rag_chain_with_source.invoke(\"what is anthroscopic surgery \")\n",
    "# Print the AI model's answer\n",
    "print(response['answer'].content)\n",
    "\n",
    "# Print the retrieved context documents that were used to generate the answer\n",
    "print(response['context'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "hgILXVKutOwQ",
    "outputId": "6da16540-cb6f-4794-f09e-8a8fbc95e76d"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "There are different types of acne including:\n",
      "\n",
      "- Mild noninflammatory acne: whiteheads and blackheads.\n",
      "- Moderate and severe inflammatory types: papules, pustules, cysts, and nodules.\n",
      "[Document(metadata={'page': 37, 'source': './Medical_book.pdf'}, page_content='Resources\\nBOOKS\\nA Manual of Laboratory and Diagnostic Tests.5th ed. Ed.\\nFrancis Fishback. Philadelphia: Lippincott, 1996.\\nGarza, Diana, and Kathleen Becan-McBride. Phlebotomy\\nHandbook. 4th ed. Stamford: Appleton & Lange, 1996.\\nPERIODICALS\\nMoul, Judd W., et al. “The Contemporary Value of Pretreat-\\nment Prostatic Acid Phosphatase to Predict Pathological\\nStage and Recurrence in Radical Prostatectomy Cases.”\\nJournal of Urology(Mar. 1998): 935-940.\\nNancy J. Nordenson\\nAcid reflux see Heartburn\\nAcidosis see Respiratory acidosis; Renal\\ntubular acidosis; Metabolic acidosis\\nAcne\\nDefinition\\nAcne is a common skin disease characterized by\\npimples on the face, chest, and back. It occurs when the\\npores of the skin become clogged with oil, dead skin\\ncells, and bacteria.\\nDescription\\nAcne vulgaris, the medical term for common acne, is\\nthe most common skin disease. It affects nearly 17 million\\npeople in the United States. While acne can arise at any\\nage, it usually begins at puberty and worsens during ado-\\nlescence. Nearly 85% of people develop acne at some time\\nbetween the ages of 12-25 years. Up to 20% of women\\ndevelop mild acne. It is also found in some newborns.\\nThe sebaceous glands lie just beneath the skin’s sur-\\nface. They produce an oil called sebum, the skin’s natural\\nmoisturizer. These glands and the hair follicles within\\nwhich they are found are called sebaceous follicles.\\nThese follicles open onto the skin through pores. At\\npuberty, increased levels of androgens (male hormones)\\ncause the glands to produce too much sebum. When\\nexcess sebum combines with dead, sticky skin cells, a\\nhard plug, or comedo, forms that blocks the pore. Mild\\nnoninflammatory acne consists of the two types of come-\\ndones, whiteheads and blackheads.\\nModerate and severe inflammatory types of acne\\nresult after the plugged follicle is invaded by Propioni-\\nbacterium acnes , a bacteria that normally lives on the\\nskin. A pimple forms when the damaged follicle weakens\\nand bursts open, releasing sebum, bacteria, and skin and\\nwhite blood cells into the surrounding tissues. Inflamed\\npimples near the skin’s surface are called papules; when\\ndeeper, they are called pustules. The most severe type of\\nacne consists of cysts (closed sacs) and nodules (hard\\nswellings). Scarring occurs when new skin cells are laid\\ndown to replace damaged cells.\\nThe most common sites of acne are the face, chest,\\nshoulders, and back since these are the parts of the body\\nwhere the most sebaceous follicles are found.\\nCauses and symptoms\\nThe exact cause of acne is unknown. Several risk\\nfactors have been identified:\\n• Age. Due to the hormonal changes they experience,\\nteenagers are more likely to develop acne.\\n• Gender. Boys have more severe acne and develop it\\nmore often than girls.\\n• Disease. Hormonal disorders can complicate acne in\\ngirls.\\n• Heredity. Individuals with a family history of acne have\\ngreater susceptibility to the disease.\\n• Hormonal changes. Acne can flare up before menstrua-\\ntion, during pregnancy, and menopause.\\n• Diet. No foods cause acne, but certain foods may cause\\nflare-ups.\\n• Drugs. Acne can be a side effect of drugs including\\ntranquilizers, antidepressants, antibiotics, oral contra-\\nceptives, and anabolic steroids.\\n• Personal hygiene. Abrasive soaps, hard scrubbing, or\\npicking at pimples will make them worse.\\n• Cosmetics. Oil-based makeup and hair sprays worsen\\nacne.\\n• Environment. Exposure to oils and greases, polluted air,\\nand sweating in hot weather aggravate acne.\\n• Stress. Emotional stress may contribute to acne.\\nAcne is usually not conspicuous, although inflamed\\nlesions may cause pain, tenderness, itching, or swelling.\\nThe most troubling aspects of these lesions are the nega-\\ntive cosmetic effects and potential for scarring. Some\\npeople, especially teenagers, become emotionally upset\\nabout their condition, and have problems forming rela-\\ntionships or keeping jobs.\\nDiagnosis\\nAcne patients are often treated by family doctors.\\nComplicated cases are referred to a dermatologist, a skin\\nGALE ENCYCLOPEDIA OF MEDICINE 224\\nAcne\\nGEM - 0001 to 0432 - A  10/22/03 1:41 PM  Page 24'), Document(metadata={'page': 37, 'source': './Medical_book.pdf'}, page_content='Resources\\nBOOKS\\nA Manual of Laboratory and Diagnostic Tests.5th ed. Ed.\\nFrancis Fishback. Philadelphia: Lippincott, 1996.\\nGarza, Diana, and Kathleen Becan-McBride. Phlebotomy\\nHandbook. 4th ed. Stamford: Appleton & Lange, 1996.\\nPERIODICALS\\nMoul, Judd W., et al. “The Contemporary Value of Pretreat-\\nment Prostatic Acid Phosphatase to Predict Pathological\\nStage and Recurrence in Radical Prostatectomy Cases.”\\nJournal of Urology(Mar. 1998): 935-940.\\nNancy J. Nordenson\\nAcid reflux see Heartburn\\nAcidosis see Respiratory acidosis; Renal\\ntubular acidosis; Metabolic acidosis\\nAcne\\nDefinition\\nAcne is a common skin disease characterized by\\npimples on the face, chest, and back. It occurs when the\\npores of the skin become clogged with oil, dead skin\\ncells, and bacteria.\\nDescription\\nAcne vulgaris, the medical term for common acne, is\\nthe most common skin disease. It affects nearly 17 million\\npeople in the United States. While acne can arise at any\\nage, it usually begins at puberty and worsens during ado-\\nlescence. Nearly 85% of people develop acne at some time\\nbetween the ages of 12-25 years. Up to 20% of women\\ndevelop mild acne. It is also found in some newborns.\\nThe sebaceous glands lie just beneath the skin’s sur-\\nface. They produce an oil called sebum, the skin’s natural\\nmoisturizer. These glands and the hair follicles within\\nwhich they are found are called sebaceous follicles.\\nThese follicles open onto the skin through pores. At\\npuberty, increased levels of androgens (male hormones)\\ncause the glands to produce too much sebum. When\\nexcess sebum combines with dead, sticky skin cells, a\\nhard plug, or comedo, forms that blocks the pore. Mild\\nnoninflammatory acne consists of the two types of come-\\ndones, whiteheads and blackheads.\\nModerate and severe inflammatory types of acne\\nresult after the plugged follicle is invaded by Propioni-\\nbacterium acnes , a bacteria that normally lives on the\\nskin. A pimple forms when the damaged follicle weakens\\nand bursts open, releasing sebum, bacteria, and skin and\\nwhite blood cells into the surrounding tissues. Inflamed\\npimples near the skin’s surface are called papules; when\\ndeeper, they are called pustules. The most severe type of\\nacne consists of cysts (closed sacs) and nodules (hard\\nswellings). Scarring occurs when new skin cells are laid\\ndown to replace damaged cells.\\nThe most common sites of acne are the face, chest,\\nshoulders, and back since these are the parts of the body\\nwhere the most sebaceous follicles are found.\\nCauses and symptoms\\nThe exact cause of acne is unknown. Several risk\\nfactors have been identified:\\n• Age. Due to the hormonal changes they experience,\\nteenagers are more likely to develop acne.\\n• Gender. Boys have more severe acne and develop it\\nmore often than girls.\\n• Disease. Hormonal disorders can complicate acne in\\ngirls.\\n• Heredity. Individuals with a family history of acne have\\ngreater susceptibility to the disease.\\n• Hormonal changes. Acne can flare up before menstrua-\\ntion, during pregnancy, and menopause.\\n• Diet. No foods cause acne, but certain foods may cause\\nflare-ups.\\n• Drugs. Acne can be a side effect of drugs including\\ntranquilizers, antidepressants, antibiotics, oral contra-\\nceptives, and anabolic steroids.\\n• Personal hygiene. Abrasive soaps, hard scrubbing, or\\npicking at pimples will make them worse.\\n• Cosmetics. Oil-based makeup and hair sprays worsen\\nacne.\\n• Environment. Exposure to oils and greases, polluted air,\\nand sweating in hot weather aggravate acne.\\n• Stress. Emotional stress may contribute to acne.\\nAcne is usually not conspicuous, although inflamed\\nlesions may cause pain, tenderness, itching, or swelling.\\nThe most troubling aspects of these lesions are the nega-\\ntive cosmetic effects and potential for scarring. Some\\npeople, especially teenagers, become emotionally upset\\nabout their condition, and have problems forming rela-\\ntionships or keeping jobs.\\nDiagnosis\\nAcne patients are often treated by family doctors.\\nComplicated cases are referred to a dermatologist, a skin\\nGALE ENCYCLOPEDIA OF MEDICINE 224\\nAcne\\nGEM - 0001 to 0432 - A  10/22/03 1:41 PM  Page 24'), Document(metadata={'page': 37, 'source': '/Users/innovapathinc/Desktop/Gen Ai Topics /Retrieval_eval/ML_GenAI_Concepts/RAG/Data/Medical_book.pdf'}, page_content='Resources\\nBOOKS\\nA Manual of Laboratory and Diagnostic Tests.5th ed. Ed.\\nFrancis Fishback. Philadelphia: Lippincott, 1996.\\nGarza, Diana, and Kathleen Becan-McBride. Phlebotomy\\nHandbook. 4th ed. Stamford: Appleton & Lange, 1996.\\nPERIODICALS\\nMoul, Judd W., et al. “The Contemporary Value of Pretreat-\\nment Prostatic Acid Phosphatase to Predict Pathological\\nStage and Recurrence in Radical Prostatectomy Cases.”\\nJournal of Urology(Mar. 1998): 935-940.\\nNancy J. Nordenson\\nAcid reflux see Heartburn\\nAcidosis see Respiratory acidosis; Renal\\ntubular acidosis; Metabolic acidosis\\nAcne\\nDefinition\\nAcne is a common skin disease characterized by\\npimples on the face, chest, and back. It occurs when the\\npores of the skin become clogged with oil, dead skin\\ncells, and bacteria.\\nDescription\\nAcne vulgaris, the medical term for common acne, is\\nthe most common skin disease. It affects nearly 17 million\\npeople in the United States. While acne can arise at any\\nage, it usually begins at puberty and worsens during ado-\\nlescence. Nearly 85% of people develop acne at some time\\nbetween the ages of 12-25 years. Up to 20% of women\\ndevelop mild acne. It is also found in some newborns.\\nThe sebaceous glands lie just beneath the skin’s sur-\\nface. They produce an oil called sebum, the skin’s natural\\nmoisturizer. These glands and the hair follicles within\\nwhich they are found are called sebaceous follicles.\\nThese follicles open onto the skin through pores. At\\npuberty, increased levels of androgens (male hormones)\\ncause the glands to produce too much sebum. When\\nexcess sebum combines with dead, sticky skin cells, a\\nhard plug, or comedo, forms that blocks the pore. Mild\\nnoninflammatory acne consists of the two types of come-\\ndones, whiteheads and blackheads.\\nModerate and severe inflammatory types of acne\\nresult after the plugged follicle is invaded by Propioni-\\nbacterium acnes , a bacteria that normally lives on the\\nskin. A pimple forms when the damaged follicle weakens\\nand bursts open, releasing sebum, bacteria, and skin and\\nwhite blood cells into the surrounding tissues. Inflamed\\npimples near the skin’s surface are called papules; when\\ndeeper, they are called pustules. The most severe type of\\nacne consists of cysts (closed sacs) and nodules (hard\\nswellings). Scarring occurs when new skin cells are laid\\ndown to replace damaged cells.\\nThe most common sites of acne are the face, chest,\\nshoulders, and back since these are the parts of the body\\nwhere the most sebaceous follicles are found.\\nCauses and symptoms\\nThe exact cause of acne is unknown. Several risk\\nfactors have been identified:\\n• Age. Due to the hormonal changes they experience,\\nteenagers are more likely to develop acne.\\n• Gender. Boys have more severe acne and develop it\\nmore often than girls.\\n• Disease. Hormonal disorders can complicate acne in\\ngirls.\\n• Heredity. Individuals with a family history of acne have\\ngreater susceptibility to the disease.\\n• Hormonal changes. Acne can flare up before menstrua-\\ntion, during pregnancy, and menopause.\\n• Diet. No foods cause acne, but certain foods may cause\\nflare-ups.\\n• Drugs. Acne can be a side effect of drugs including\\ntranquilizers, antidepressants, antibiotics, oral contra-\\nceptives, and anabolic steroids.\\n• Personal hygiene. Abrasive soaps, hard scrubbing, or\\npicking at pimples will make them worse.\\n• Cosmetics. Oil-based makeup and hair sprays worsen\\nacne.\\n• Environment. Exposure to oils and greases, polluted air,\\nand sweating in hot weather aggravate acne.\\n• Stress. Emotional stress may contribute to acne.\\nAcne is usually not conspicuous, although inflamed\\nlesions may cause pain, tenderness, itching, or swelling.\\nThe most troubling aspects of these lesions are the nega-\\ntive cosmetic effects and potential for scarring. Some\\npeople, especially teenagers, become emotionally upset\\nabout their condition, and have problems forming rela-\\ntionships or keeping jobs.\\nDiagnosis\\nAcne patients are often treated by family doctors.\\nComplicated cases are referred to a dermatologist, a skin\\nGALE ENCYCLOPEDIA OF MEDICINE 224\\nAcne\\nGEM - 0001 to 0432 - A  10/22/03 1:41 PM  Page 24'), Document(metadata={'page': 37, 'source': '/Users/innovapathinc/Desktop/Gen Ai Topics /Retrieval_eval/ML_GenAI_Concepts/RAG/Data/Medical_book.pdf'}, page_content='Resources\\nBOOKS\\nA Manual of Laboratory and Diagnostic Tests.5th ed. Ed.\\nFrancis Fishback. Philadelphia: Lippincott, 1996.\\nGarza, Diana, and Kathleen Becan-McBride. Phlebotomy\\nHandbook. 4th ed. Stamford: Appleton & Lange, 1996.\\nPERIODICALS\\nMoul, Judd W., et al. “The Contemporary Value of Pretreat-\\nment Prostatic Acid Phosphatase to Predict Pathological\\nStage and Recurrence in Radical Prostatectomy Cases.”\\nJournal of Urology(Mar. 1998): 935-940.\\nNancy J. Nordenson\\nAcid reflux see Heartburn\\nAcidosis see Respiratory acidosis; Renal\\ntubular acidosis; Metabolic acidosis\\nAcne\\nDefinition\\nAcne is a common skin disease characterized by\\npimples on the face, chest, and back. It occurs when the\\npores of the skin become clogged with oil, dead skin\\ncells, and bacteria.\\nDescription\\nAcne vulgaris, the medical term for common acne, is\\nthe most common skin disease. It affects nearly 17 million\\npeople in the United States. While acne can arise at any\\nage, it usually begins at puberty and worsens during ado-\\nlescence. Nearly 85% of people develop acne at some time\\nbetween the ages of 12-25 years. Up to 20% of women\\ndevelop mild acne. It is also found in some newborns.\\nThe sebaceous glands lie just beneath the skin’s sur-\\nface. They produce an oil called sebum, the skin’s natural\\nmoisturizer. These glands and the hair follicles within\\nwhich they are found are called sebaceous follicles.\\nThese follicles open onto the skin through pores. At\\npuberty, increased levels of androgens (male hormones)\\ncause the glands to produce too much sebum. When\\nexcess sebum combines with dead, sticky skin cells, a\\nhard plug, or comedo, forms that blocks the pore. Mild\\nnoninflammatory acne consists of the two types of come-\\ndones, whiteheads and blackheads.\\nModerate and severe inflammatory types of acne\\nresult after the plugged follicle is invaded by Propioni-\\nbacterium acnes , a bacteria that normally lives on the\\nskin. A pimple forms when the damaged follicle weakens\\nand bursts open, releasing sebum, bacteria, and skin and\\nwhite blood cells into the surrounding tissues. Inflamed\\npimples near the skin’s surface are called papules; when\\ndeeper, they are called pustules. The most severe type of\\nacne consists of cysts (closed sacs) and nodules (hard\\nswellings). Scarring occurs when new skin cells are laid\\ndown to replace damaged cells.\\nThe most common sites of acne are the face, chest,\\nshoulders, and back since these are the parts of the body\\nwhere the most sebaceous follicles are found.\\nCauses and symptoms\\nThe exact cause of acne is unknown. Several risk\\nfactors have been identified:\\n• Age. Due to the hormonal changes they experience,\\nteenagers are more likely to develop acne.\\n• Gender. Boys have more severe acne and develop it\\nmore often than girls.\\n• Disease. Hormonal disorders can complicate acne in\\ngirls.\\n• Heredity. Individuals with a family history of acne have\\ngreater susceptibility to the disease.\\n• Hormonal changes. Acne can flare up before menstrua-\\ntion, during pregnancy, and menopause.\\n• Diet. No foods cause acne, but certain foods may cause\\nflare-ups.\\n• Drugs. Acne can be a side effect of drugs including\\ntranquilizers, antidepressants, antibiotics, oral contra-\\nceptives, and anabolic steroids.\\n• Personal hygiene. Abrasive soaps, hard scrubbing, or\\npicking at pimples will make them worse.\\n• Cosmetics. Oil-based makeup and hair sprays worsen\\nacne.\\n• Environment. Exposure to oils and greases, polluted air,\\nand sweating in hot weather aggravate acne.\\n• Stress. Emotional stress may contribute to acne.\\nAcne is usually not conspicuous, although inflamed\\nlesions may cause pain, tenderness, itching, or swelling.\\nThe most troubling aspects of these lesions are the nega-\\ntive cosmetic effects and potential for scarring. Some\\npeople, especially teenagers, become emotionally upset\\nabout their condition, and have problems forming rela-\\ntionships or keeping jobs.\\nDiagnosis\\nAcne patients are often treated by family doctors.\\nComplicated cases are referred to a dermatologist, a skin\\nGALE ENCYCLOPEDIA OF MEDICINE 224\\nAcne\\nGEM - 0001 to 0432 - A  10/22/03 1:41 PM  Page 24')]\n"
     ]
    }
   ],
   "source": [
    "response = rag_chain_with_source.invoke(\"what type of acne\")\n",
    "print(response['answer'].content)\n",
    "print(response['context'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "LMgNaoMatVKq",
    "outputId": "762b7f54-a9a3-4c38-9244-91131ad8ac51"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "I don't know. The provided context does not contain information about types of cars.\n",
      "[Document(metadata={'page': 564, 'source': '/Users/innovapathinc/Desktop/Gen Ai Topics /Retrieval_eval/ML_GenAI_Concepts/RAG/Data/Medical_book.pdf'}, page_content='(HLA) that are on the surface of bone marrow cells. If\\nthe donor and the recipient have very dissimilar antigens,\\nthe recipient’s immune system regards the donor’s bone\\nmarrow cells as invaders and launches a destructive\\nattack against them. Such an attack negates any benefits\\noffered by the transplant.\\nHLA matching\\nThere are only five major HLA classes or types—\\ndesignated HLA–A,–B, –C,–D, and class III—but much\\nvariation within the groupings. For example, HLA–A\\nfrom one individual may be similar to, but not the same\\nas, HLA–A in another individual; such a situation can\\nrender a transplant from one to the other impossible.\\nHLA matching is more likely if the donor and recip-\\nient are related, particularly if they are siblings; however,\\nan unrelated donor may be a potential match. Only in\\nrare cases is matching HLA types between two people\\nnot an issue: if the recipient has an identical twin. Identi-\\ncal twins carry the same genes; therefore, the same anti-\\ngens. A bone marrow transplant between identical twins\\nis called a syngeneic transplant.\\nPeripheral blood stem cell transplants\\nA relatively recent development in stem cell trans-\\nplantation is the use of peripheral blood cells instead of\\nstem cells from bone marrow. Peripheral blood stem cells\\n(PBSCs) are obtained from circulating blood rather than\\nfrom bone marrow, but the amount of stem cells found in\\nthe peripheral blood is much smaller than the amount of\\nstem cells found in the bone marrow. Peripheral blood\\nstem cells can be used in either autologous or allogeneic\\ntransplants. The majority of PBSC transplants are autolo-\\ngous. However, recent clinical studies indicate that\\nPBSCs are being used more frequently than bone mar-\\nrow for allogeneic bone marrow transplantation.\\nThe advantages of PBSC transplants when compared\\nto bone marrow transplants are: in allogeneic transplanta-\\ntion, haematopoietic and immune recovery are faster with\\nPBSCs which reduces the potential for disease recur-\\nrence, primarily graft-versus-host-disease. In autologous\\ntransplantation, the use of PBSCs can result in faster\\nblood countrecoveries. Also, some medical conditions\\nexist in which the recipient cannot accept bone marrow\\nstem cell transplants, but can accept PBSC transplants.\\nSome possible disadvantages to PBSC transplant versus\\nbone marrow transplantation are: so much more fluid vol-\\nume is necessary to collect enough PBSCs that, at the\\ntime of infusing the new stem cells into the recipient, the\\nfluid can collect in the lungs or cause temporary kidney\\nproblems. Also, the time commitment for the donor for a\\nPBSC transplant is considerable. When the PBSCs are\\nbeing collected, several outpatient sessions are needed\\nand each session lasts approximately two–four hours.\\nThe transplant procedure\\nBONE MARROW TRANSPLANTATION. The bone mar-\\nrow extraction, or harvest, is the same whether for an autol-\\nogous or allogeneic transplant. Harvesting is done under\\ngeneral anesthesia (i.e., the donor sleeps through the proce-\\ndure), and discomfort is usually minimal afterwards. Bone\\nmarrow is drawn from the iliac crest (the part of the hip\\nbone to either side of the lower back) with a special needle\\nand a syringe. Several punctures are usually necessary to\\ncollect the needed amount of bone marrow, approximately\\n1–2 quarts (0.9-1.91). (This amount is only a small percent-\\nage of the total bone marrow and is typically replaced with-\\nin four weeks.) The donor remains at the hospital for 24–48\\nhours and can resume normal activities within a few days.\\nIf the bone marrow is meant for an autologous trans-\\nplant, it is stored at –112 to –320°F (–80 to –196°C) until\\nit is needed. Bone marrow for an allogeneic transplant is\\nsometimes treated to remove the donor’s T cells (a type\\nof white blood cell) or to remove ABO (blood type) anti-\\ngens; otherwise, it is transplanted without modification.\\nGALE ENCYCLOPEDIA OF MEDICINE 2 551\\nBone marrow transplantation\\nIn autologous bone marrow transplantation, stem cells are\\ncollected from the patient. Once the patient has undergone\\nchemotherapy, the cells are replaced in the blood via an intra-\\nvenous catheter.The cells return to the bone marrow and\\nbegin producing healthy new cells.(Illustration by Argosy Inc.)\\nGEM -0433 to 0624 - B  10/22/03 6:08 PM  Page 551'), Document(metadata={'page': 564, 'source': '/Users/innovapathinc/Desktop/Gen Ai Topics /Retrieval_eval/ML_GenAI_Concepts/RAG/Data/Medical_book.pdf'}, page_content='(HLA) that are on the surface of bone marrow cells. If\\nthe donor and the recipient have very dissimilar antigens,\\nthe recipient’s immune system regards the donor’s bone\\nmarrow cells as invaders and launches a destructive\\nattack against them. Such an attack negates any benefits\\noffered by the transplant.\\nHLA matching\\nThere are only five major HLA classes or types—\\ndesignated HLA–A,–B, –C,–D, and class III—but much\\nvariation within the groupings. For example, HLA–A\\nfrom one individual may be similar to, but not the same\\nas, HLA–A in another individual; such a situation can\\nrender a transplant from one to the other impossible.\\nHLA matching is more likely if the donor and recip-\\nient are related, particularly if they are siblings; however,\\nan unrelated donor may be a potential match. Only in\\nrare cases is matching HLA types between two people\\nnot an issue: if the recipient has an identical twin. Identi-\\ncal twins carry the same genes; therefore, the same anti-\\ngens. A bone marrow transplant between identical twins\\nis called a syngeneic transplant.\\nPeripheral blood stem cell transplants\\nA relatively recent development in stem cell trans-\\nplantation is the use of peripheral blood cells instead of\\nstem cells from bone marrow. Peripheral blood stem cells\\n(PBSCs) are obtained from circulating blood rather than\\nfrom bone marrow, but the amount of stem cells found in\\nthe peripheral blood is much smaller than the amount of\\nstem cells found in the bone marrow. Peripheral blood\\nstem cells can be used in either autologous or allogeneic\\ntransplants. The majority of PBSC transplants are autolo-\\ngous. However, recent clinical studies indicate that\\nPBSCs are being used more frequently than bone mar-\\nrow for allogeneic bone marrow transplantation.\\nThe advantages of PBSC transplants when compared\\nto bone marrow transplants are: in allogeneic transplanta-\\ntion, haematopoietic and immune recovery are faster with\\nPBSCs which reduces the potential for disease recur-\\nrence, primarily graft-versus-host-disease. In autologous\\ntransplantation, the use of PBSCs can result in faster\\nblood countrecoveries. Also, some medical conditions\\nexist in which the recipient cannot accept bone marrow\\nstem cell transplants, but can accept PBSC transplants.\\nSome possible disadvantages to PBSC transplant versus\\nbone marrow transplantation are: so much more fluid vol-\\nume is necessary to collect enough PBSCs that, at the\\ntime of infusing the new stem cells into the recipient, the\\nfluid can collect in the lungs or cause temporary kidney\\nproblems. Also, the time commitment for the donor for a\\nPBSC transplant is considerable. When the PBSCs are\\nbeing collected, several outpatient sessions are needed\\nand each session lasts approximately two–four hours.\\nThe transplant procedure\\nBONE MARROW TRANSPLANTATION. The bone mar-\\nrow extraction, or harvest, is the same whether for an autol-\\nogous or allogeneic transplant. Harvesting is done under\\ngeneral anesthesia (i.e., the donor sleeps through the proce-\\ndure), and discomfort is usually minimal afterwards. Bone\\nmarrow is drawn from the iliac crest (the part of the hip\\nbone to either side of the lower back) with a special needle\\nand a syringe. Several punctures are usually necessary to\\ncollect the needed amount of bone marrow, approximately\\n1–2 quarts (0.9-1.91). (This amount is only a small percent-\\nage of the total bone marrow and is typically replaced with-\\nin four weeks.) The donor remains at the hospital for 24–48\\nhours and can resume normal activities within a few days.\\nIf the bone marrow is meant for an autologous trans-\\nplant, it is stored at –112 to –320°F (–80 to –196°C) until\\nit is needed. Bone marrow for an allogeneic transplant is\\nsometimes treated to remove the donor’s T cells (a type\\nof white blood cell) or to remove ABO (blood type) anti-\\ngens; otherwise, it is transplanted without modification.\\nGALE ENCYCLOPEDIA OF MEDICINE 2 551\\nBone marrow transplantation\\nIn autologous bone marrow transplantation, stem cells are\\ncollected from the patient. Once the patient has undergone\\nchemotherapy, the cells are replaced in the blood via an intra-\\nvenous catheter.The cells return to the bone marrow and\\nbegin producing healthy new cells.(Illustration by Argosy Inc.)\\nGEM -0433 to 0624 - B  10/22/03 6:08 PM  Page 551'), Document(metadata={'page': 564, 'source': '/Users/innovapathinc/Desktop/Gen Ai Topics /Retrieval_eval/ML_GenAI_Concepts/RAG/Data/Medical_book.pdf'}, page_content='(HLA) that are on the surface of bone marrow cells. If\\nthe donor and the recipient have very dissimilar antigens,\\nthe recipient’s immune system regards the donor’s bone\\nmarrow cells as invaders and launches a destructive\\nattack against them. Such an attack negates any benefits\\noffered by the transplant.\\nHLA matching\\nThere are only five major HLA classes or types—\\ndesignated HLA–A,–B, –C,–D, and class III—but much\\nvariation within the groupings. For example, HLA–A\\nfrom one individual may be similar to, but not the same\\nas, HLA–A in another individual; such a situation can\\nrender a transplant from one to the other impossible.\\nHLA matching is more likely if the donor and recip-\\nient are related, particularly if they are siblings; however,\\nan unrelated donor may be a potential match. Only in\\nrare cases is matching HLA types between two people\\nnot an issue: if the recipient has an identical twin. Identi-\\ncal twins carry the same genes; therefore, the same anti-\\ngens. A bone marrow transplant between identical twins\\nis called a syngeneic transplant.\\nPeripheral blood stem cell transplants\\nA relatively recent development in stem cell trans-\\nplantation is the use of peripheral blood cells instead of\\nstem cells from bone marrow. Peripheral blood stem cells\\n(PBSCs) are obtained from circulating blood rather than\\nfrom bone marrow, but the amount of stem cells found in\\nthe peripheral blood is much smaller than the amount of\\nstem cells found in the bone marrow. Peripheral blood\\nstem cells can be used in either autologous or allogeneic\\ntransplants. The majority of PBSC transplants are autolo-\\ngous. However, recent clinical studies indicate that\\nPBSCs are being used more frequently than bone mar-\\nrow for allogeneic bone marrow transplantation.\\nThe advantages of PBSC transplants when compared\\nto bone marrow transplants are: in allogeneic transplanta-\\ntion, haematopoietic and immune recovery are faster with\\nPBSCs which reduces the potential for disease recur-\\nrence, primarily graft-versus-host-disease. In autologous\\ntransplantation, the use of PBSCs can result in faster\\nblood countrecoveries. Also, some medical conditions\\nexist in which the recipient cannot accept bone marrow\\nstem cell transplants, but can accept PBSC transplants.\\nSome possible disadvantages to PBSC transplant versus\\nbone marrow transplantation are: so much more fluid vol-\\nume is necessary to collect enough PBSCs that, at the\\ntime of infusing the new stem cells into the recipient, the\\nfluid can collect in the lungs or cause temporary kidney\\nproblems. Also, the time commitment for the donor for a\\nPBSC transplant is considerable. When the PBSCs are\\nbeing collected, several outpatient sessions are needed\\nand each session lasts approximately two–four hours.\\nThe transplant procedure\\nBONE MARROW TRANSPLANTATION. The bone mar-\\nrow extraction, or harvest, is the same whether for an autol-\\nogous or allogeneic transplant. Harvesting is done under\\ngeneral anesthesia (i.e., the donor sleeps through the proce-\\ndure), and discomfort is usually minimal afterwards. Bone\\nmarrow is drawn from the iliac crest (the part of the hip\\nbone to either side of the lower back) with a special needle\\nand a syringe. Several punctures are usually necessary to\\ncollect the needed amount of bone marrow, approximately\\n1–2 quarts (0.9-1.91). (This amount is only a small percent-\\nage of the total bone marrow and is typically replaced with-\\nin four weeks.) The donor remains at the hospital for 24–48\\nhours and can resume normal activities within a few days.\\nIf the bone marrow is meant for an autologous trans-\\nplant, it is stored at –112 to –320°F (–80 to –196°C) until\\nit is needed. Bone marrow for an allogeneic transplant is\\nsometimes treated to remove the donor’s T cells (a type\\nof white blood cell) or to remove ABO (blood type) anti-\\ngens; otherwise, it is transplanted without modification.\\nGALE ENCYCLOPEDIA OF MEDICINE 2 551\\nBone marrow transplantation\\nIn autologous bone marrow transplantation, stem cells are\\ncollected from the patient. Once the patient has undergone\\nchemotherapy, the cells are replaced in the blood via an intra-\\nvenous catheter.The cells return to the bone marrow and\\nbegin producing healthy new cells.(Illustration by Argosy Inc.)\\nGEM -0433 to 0624 - B  10/22/03 6:08 PM  Page 551'), Document(metadata={'page': 564, 'source': '/Users/innovapathinc/Desktop/Gen Ai Topics /Retrieval_eval/ML_GenAI_Concepts/RAG/Data/Medical_book.pdf'}, page_content='(HLA) that are on the surface of bone marrow cells. If\\nthe donor and the recipient have very dissimilar antigens,\\nthe recipient’s immune system regards the donor’s bone\\nmarrow cells as invaders and launches a destructive\\nattack against them. Such an attack negates any benefits\\noffered by the transplant.\\nHLA matching\\nThere are only five major HLA classes or types—\\ndesignated HLA–A,–B, –C,–D, and class III—but much\\nvariation within the groupings. For example, HLA–A\\nfrom one individual may be similar to, but not the same\\nas, HLA–A in another individual; such a situation can\\nrender a transplant from one to the other impossible.\\nHLA matching is more likely if the donor and recip-\\nient are related, particularly if they are siblings; however,\\nan unrelated donor may be a potential match. Only in\\nrare cases is matching HLA types between two people\\nnot an issue: if the recipient has an identical twin. Identi-\\ncal twins carry the same genes; therefore, the same anti-\\ngens. A bone marrow transplant between identical twins\\nis called a syngeneic transplant.\\nPeripheral blood stem cell transplants\\nA relatively recent development in stem cell trans-\\nplantation is the use of peripheral blood cells instead of\\nstem cells from bone marrow. Peripheral blood stem cells\\n(PBSCs) are obtained from circulating blood rather than\\nfrom bone marrow, but the amount of stem cells found in\\nthe peripheral blood is much smaller than the amount of\\nstem cells found in the bone marrow. Peripheral blood\\nstem cells can be used in either autologous or allogeneic\\ntransplants. The majority of PBSC transplants are autolo-\\ngous. However, recent clinical studies indicate that\\nPBSCs are being used more frequently than bone mar-\\nrow for allogeneic bone marrow transplantation.\\nThe advantages of PBSC transplants when compared\\nto bone marrow transplants are: in allogeneic transplanta-\\ntion, haematopoietic and immune recovery are faster with\\nPBSCs which reduces the potential for disease recur-\\nrence, primarily graft-versus-host-disease. In autologous\\ntransplantation, the use of PBSCs can result in faster\\nblood countrecoveries. Also, some medical conditions\\nexist in which the recipient cannot accept bone marrow\\nstem cell transplants, but can accept PBSC transplants.\\nSome possible disadvantages to PBSC transplant versus\\nbone marrow transplantation are: so much more fluid vol-\\nume is necessary to collect enough PBSCs that, at the\\ntime of infusing the new stem cells into the recipient, the\\nfluid can collect in the lungs or cause temporary kidney\\nproblems. Also, the time commitment for the donor for a\\nPBSC transplant is considerable. When the PBSCs are\\nbeing collected, several outpatient sessions are needed\\nand each session lasts approximately two–four hours.\\nThe transplant procedure\\nBONE MARROW TRANSPLANTATION. The bone mar-\\nrow extraction, or harvest, is the same whether for an autol-\\nogous or allogeneic transplant. Harvesting is done under\\ngeneral anesthesia (i.e., the donor sleeps through the proce-\\ndure), and discomfort is usually minimal afterwards. Bone\\nmarrow is drawn from the iliac crest (the part of the hip\\nbone to either side of the lower back) with a special needle\\nand a syringe. Several punctures are usually necessary to\\ncollect the needed amount of bone marrow, approximately\\n1–2 quarts (0.9-1.91). (This amount is only a small percent-\\nage of the total bone marrow and is typically replaced with-\\nin four weeks.) The donor remains at the hospital for 24–48\\nhours and can resume normal activities within a few days.\\nIf the bone marrow is meant for an autologous trans-\\nplant, it is stored at –112 to –320°F (–80 to –196°C) until\\nit is needed. Bone marrow for an allogeneic transplant is\\nsometimes treated to remove the donor’s T cells (a type\\nof white blood cell) or to remove ABO (blood type) anti-\\ngens; otherwise, it is transplanted without modification.\\nGALE ENCYCLOPEDIA OF MEDICINE 2 551\\nBone marrow transplantation\\nIn autologous bone marrow transplantation, stem cells are\\ncollected from the patient. Once the patient has undergone\\nchemotherapy, the cells are replaced in the blood via an intra-\\nvenous catheter.The cells return to the bone marrow and\\nbegin producing healthy new cells.(Illustration by Argosy Inc.)\\nGEM -0433 to 0624 - B  10/22/03 6:08 PM  Page 551')]\n"
     ]
    }
   ],
   "source": [
    "response = rag_chain_with_source.invoke(\"types of cars?\")\n",
    "print(response['answer'].content)\n",
    "print(response['context'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/"
    },
    "id": "Wd1fnvA3y_BL",
    "outputId": "91c70bef-9c32-4abb-d697-bf0ddb94d144"
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "I don't know. The provided context does not contain any information about a \"lucid referral program.\"\n",
      "[Document(metadata={'page': 382, 'source': './Medical_book.pdf'}, page_content='suitable surfaces. The space can be as simple as a kitchen\\nor office table, or as fancy as a specialized artist’s studio.\\nThe artist should have adequate time to become\\ncomfortable with and explore the creative process. This\\nis especially true for people who do not consider them-\\nselves “artists” and may be uncomfortable with the con-\\ncept. If performed in a therapy group or one-on-one ses-\\nsion, the art therapist should be available to answer gen-\\neral questions about materials and/or the creative\\nprocess. However, the therapist should be careful not to\\ninfluence the creation or interpretation of the work.\\nPrecautions\\nArt materials and techniques should match the age\\nand ability of the client. People with impairments, such\\nas traumatic brain injury or an organic neurological con-\\ndition, may have difficulties with the self-discovery por-\\ntion of the art therapy process depending on their level of\\nfunctioning. However, they may still benefit from art\\ntherapy through the sensory stimulation it provides and\\nthe pleasure they get from artistic creation.\\nWhile art is accessible to all (with or without a ther-\\napist to guide the process), it may be difficult to tap the\\nfull potential of the interpretive part of art therapy with-\\nout a therapist to guide the process. When art therapy is\\nchosen as a therapeutic tool to cope with a physical con-\\ndition, it should be treated as a supplemental therapy and\\nnot as a substitute for conventional medical treatments.\\nResearch and general acceptance\\nA wide body of literature supports the use of art\\ntherapy in a mental health capacity. And as the mind-\\nbody connection between psychological well-being and\\nphysical health is further documented by studies in the\\nfield, art therapy gains greater acceptance by mainstream\\nmedicine as a therapeutic technique for organic illness.\\nResources\\nBOOKS\\nFausek, Diane. A Practical Guide to Art Therapy.Binghamton,\\nNew York: Haworth Press, 1997.\\nGanim, Barbara. Art and Healing: Using expressive art to heal\\nyour body, mind, and spirit. New York: Three Rivers\\nPress, 1999.\\nMalchiodi, Cathy A. The Art Therapy Sourcebook.Los Ange-\\nles: Lowell House, 1998.\\nMcNiff, Shaun. Art as Medicine: Creating a Therapy of the\\nImagination. Boston: Shambhala, 1992.\\nORGANIZATIONS\\nAmerican Art Therapy Association.1202 Allanson Rd.,\\nMundelein, IL 60060-3808. 888-290-0878 or 847-949-\\nKEY TERMS\\nCatharsis —Therapeutic discharge of emotional\\ntension by recalling past events.\\nMandala—A design, usually circular, that appears\\nin religion and art. In Buddhism and Hinduism,\\nthe mandala has religious ritual purposes and\\nserves as a yantra (a geometric emblem or instru-\\nment of contemplation).\\nOrganic illness —A physically, biologically based\\nillness.\\n6064. Fax: 847-566-4580. arttherapy@ntr.net. <http://\\nwww.arttherapy.org>.\\nPaula Ford-Martin\\nAsbestosis\\nDefinition\\nAsbestosis is chronic, progressive inflammation of\\nthe lung. It is not contagious.\\nDescription\\nAsbestosis is a consequence of prolonged exposure\\nto large quantities of asbestos, a material once widely\\nused in construction, insulation, and manufacturing.\\nWhen asbestos is inhaled, fibers penetrate the breathing\\npassages and irritate, fill, inflame, and scar lung tissue. In\\nadvanced asbestosis,, the lungs shrink, stiffen, and\\nbecome honeycombed (riddled with tiny holes).\\nLegislation has reduced use of asbestos in the United\\nStates, but workers who handle automobile brake shoe\\nlinings, boiler insulation, ceiling acoustic tiles, electrical\\nequipment, and fire-resistant materials are still exposed\\nto the substance. Asbestos is used in the production of\\npaints and plastics. Significant amounts can be released\\ninto the atmosphere when old buildings or boats are\\nrazed or remodeled.\\nAsbestosis is most common in men over 40 who\\nhave worked in asbestos-related occupations. Smokers or\\nheavy drinkers have the greatest risk of developing this\\ndisease. Between 1968 and 1992, more than 10,000\\nAmericans over the age of 15 died as a result of asbesto-\\nsis. Nearly 25% of those who died lived in California or\\nGALE ENCYCLOPEDIA OF MEDICINE 2 369\\nAsbestosis\\nGEM - 0001 to 0432 - A  10/22/03 1:43 PM  Page 369'), Document(metadata={'page': 382, 'source': './Medical_book.pdf'}, page_content='suitable surfaces. The space can be as simple as a kitchen\\nor office table, or as fancy as a specialized artist’s studio.\\nThe artist should have adequate time to become\\ncomfortable with and explore the creative process. This\\nis especially true for people who do not consider them-\\nselves “artists” and may be uncomfortable with the con-\\ncept. If performed in a therapy group or one-on-one ses-\\nsion, the art therapist should be available to answer gen-\\neral questions about materials and/or the creative\\nprocess. However, the therapist should be careful not to\\ninfluence the creation or interpretation of the work.\\nPrecautions\\nArt materials and techniques should match the age\\nand ability of the client. People with impairments, such\\nas traumatic brain injury or an organic neurological con-\\ndition, may have difficulties with the self-discovery por-\\ntion of the art therapy process depending on their level of\\nfunctioning. However, they may still benefit from art\\ntherapy through the sensory stimulation it provides and\\nthe pleasure they get from artistic creation.\\nWhile art is accessible to all (with or without a ther-\\napist to guide the process), it may be difficult to tap the\\nfull potential of the interpretive part of art therapy with-\\nout a therapist to guide the process. When art therapy is\\nchosen as a therapeutic tool to cope with a physical con-\\ndition, it should be treated as a supplemental therapy and\\nnot as a substitute for conventional medical treatments.\\nResearch and general acceptance\\nA wide body of literature supports the use of art\\ntherapy in a mental health capacity. And as the mind-\\nbody connection between psychological well-being and\\nphysical health is further documented by studies in the\\nfield, art therapy gains greater acceptance by mainstream\\nmedicine as a therapeutic technique for organic illness.\\nResources\\nBOOKS\\nFausek, Diane. A Practical Guide to Art Therapy.Binghamton,\\nNew York: Haworth Press, 1997.\\nGanim, Barbara. Art and Healing: Using expressive art to heal\\nyour body, mind, and spirit. New York: Three Rivers\\nPress, 1999.\\nMalchiodi, Cathy A. The Art Therapy Sourcebook.Los Ange-\\nles: Lowell House, 1998.\\nMcNiff, Shaun. Art as Medicine: Creating a Therapy of the\\nImagination. Boston: Shambhala, 1992.\\nORGANIZATIONS\\nAmerican Art Therapy Association.1202 Allanson Rd.,\\nMundelein, IL 60060-3808. 888-290-0878 or 847-949-\\nKEY TERMS\\nCatharsis —Therapeutic discharge of emotional\\ntension by recalling past events.\\nMandala—A design, usually circular, that appears\\nin religion and art. In Buddhism and Hinduism,\\nthe mandala has religious ritual purposes and\\nserves as a yantra (a geometric emblem or instru-\\nment of contemplation).\\nOrganic illness —A physically, biologically based\\nillness.\\n6064. Fax: 847-566-4580. arttherapy@ntr.net. <http://\\nwww.arttherapy.org>.\\nPaula Ford-Martin\\nAsbestosis\\nDefinition\\nAsbestosis is chronic, progressive inflammation of\\nthe lung. It is not contagious.\\nDescription\\nAsbestosis is a consequence of prolonged exposure\\nto large quantities of asbestos, a material once widely\\nused in construction, insulation, and manufacturing.\\nWhen asbestos is inhaled, fibers penetrate the breathing\\npassages and irritate, fill, inflame, and scar lung tissue. In\\nadvanced asbestosis,, the lungs shrink, stiffen, and\\nbecome honeycombed (riddled with tiny holes).\\nLegislation has reduced use of asbestos in the United\\nStates, but workers who handle automobile brake shoe\\nlinings, boiler insulation, ceiling acoustic tiles, electrical\\nequipment, and fire-resistant materials are still exposed\\nto the substance. Asbestos is used in the production of\\npaints and plastics. Significant amounts can be released\\ninto the atmosphere when old buildings or boats are\\nrazed or remodeled.\\nAsbestosis is most common in men over 40 who\\nhave worked in asbestos-related occupations. Smokers or\\nheavy drinkers have the greatest risk of developing this\\ndisease. Between 1968 and 1992, more than 10,000\\nAmericans over the age of 15 died as a result of asbesto-\\nsis. Nearly 25% of those who died lived in California or\\nGALE ENCYCLOPEDIA OF MEDICINE 2 369\\nAsbestosis\\nGEM - 0001 to 0432 - A  10/22/03 1:43 PM  Page 369'), Document(metadata={'page': 382, 'source': './Medical_book.pdf'}, page_content='suitable surfaces. The space can be as simple as a kitchen\\nor office table, or as fancy as a specialized artist’s studio.\\nThe artist should have adequate time to become\\ncomfortable with and explore the creative process. This\\nis especially true for people who do not consider them-\\nselves “artists” and may be uncomfortable with the con-\\ncept. If performed in a therapy group or one-on-one ses-\\nsion, the art therapist should be available to answer gen-\\neral questions about materials and/or the creative\\nprocess. However, the therapist should be careful not to\\ninfluence the creation or interpretation of the work.\\nPrecautions\\nArt materials and techniques should match the age\\nand ability of the client. People with impairments, such\\nas traumatic brain injury or an organic neurological con-\\ndition, may have difficulties with the self-discovery por-\\ntion of the art therapy process depending on their level of\\nfunctioning. However, they may still benefit from art\\ntherapy through the sensory stimulation it provides and\\nthe pleasure they get from artistic creation.\\nWhile art is accessible to all (with or without a ther-\\napist to guide the process), it may be difficult to tap the\\nfull potential of the interpretive part of art therapy with-\\nout a therapist to guide the process. When art therapy is\\nchosen as a therapeutic tool to cope with a physical con-\\ndition, it should be treated as a supplemental therapy and\\nnot as a substitute for conventional medical treatments.\\nResearch and general acceptance\\nA wide body of literature supports the use of art\\ntherapy in a mental health capacity. And as the mind-\\nbody connection between psychological well-being and\\nphysical health is further documented by studies in the\\nfield, art therapy gains greater acceptance by mainstream\\nmedicine as a therapeutic technique for organic illness.\\nResources\\nBOOKS\\nFausek, Diane. A Practical Guide to Art Therapy.Binghamton,\\nNew York: Haworth Press, 1997.\\nGanim, Barbara. Art and Healing: Using expressive art to heal\\nyour body, mind, and spirit. New York: Three Rivers\\nPress, 1999.\\nMalchiodi, Cathy A. The Art Therapy Sourcebook.Los Ange-\\nles: Lowell House, 1998.\\nMcNiff, Shaun. Art as Medicine: Creating a Therapy of the\\nImagination. Boston: Shambhala, 1992.\\nORGANIZATIONS\\nAmerican Art Therapy Association.1202 Allanson Rd.,\\nMundelein, IL 60060-3808. 888-290-0878 or 847-949-\\nKEY TERMS\\nCatharsis —Therapeutic discharge of emotional\\ntension by recalling past events.\\nMandala—A design, usually circular, that appears\\nin religion and art. In Buddhism and Hinduism,\\nthe mandala has religious ritual purposes and\\nserves as a yantra (a geometric emblem or instru-\\nment of contemplation).\\nOrganic illness —A physically, biologically based\\nillness.\\n6064. Fax: 847-566-4580. arttherapy@ntr.net. <http://\\nwww.arttherapy.org>.\\nPaula Ford-Martin\\nAsbestosis\\nDefinition\\nAsbestosis is chronic, progressive inflammation of\\nthe lung. It is not contagious.\\nDescription\\nAsbestosis is a consequence of prolonged exposure\\nto large quantities of asbestos, a material once widely\\nused in construction, insulation, and manufacturing.\\nWhen asbestos is inhaled, fibers penetrate the breathing\\npassages and irritate, fill, inflame, and scar lung tissue. In\\nadvanced asbestosis,, the lungs shrink, stiffen, and\\nbecome honeycombed (riddled with tiny holes).\\nLegislation has reduced use of asbestos in the United\\nStates, but workers who handle automobile brake shoe\\nlinings, boiler insulation, ceiling acoustic tiles, electrical\\nequipment, and fire-resistant materials are still exposed\\nto the substance. Asbestos is used in the production of\\npaints and plastics. Significant amounts can be released\\ninto the atmosphere when old buildings or boats are\\nrazed or remodeled.\\nAsbestosis is most common in men over 40 who\\nhave worked in asbestos-related occupations. Smokers or\\nheavy drinkers have the greatest risk of developing this\\ndisease. Between 1968 and 1992, more than 10,000\\nAmericans over the age of 15 died as a result of asbesto-\\nsis. Nearly 25% of those who died lived in California or\\nGALE ENCYCLOPEDIA OF MEDICINE 2 369\\nAsbestosis\\nGEM - 0001 to 0432 - A  10/22/03 1:43 PM  Page 369'), Document(metadata={'page': 382, 'source': '/Users/innovapathinc/Desktop/Gen Ai Topics /Retrieval_eval/ML_GenAI_Concepts/RAG/Data/Medical_book.pdf'}, page_content='suitable surfaces. The space can be as simple as a kitchen\\nor office table, or as fancy as a specialized artist’s studio.\\nThe artist should have adequate time to become\\ncomfortable with and explore the creative process. This\\nis especially true for people who do not consider them-\\nselves “artists” and may be uncomfortable with the con-\\ncept. If performed in a therapy group or one-on-one ses-\\nsion, the art therapist should be available to answer gen-\\neral questions about materials and/or the creative\\nprocess. However, the therapist should be careful not to\\ninfluence the creation or interpretation of the work.\\nPrecautions\\nArt materials and techniques should match the age\\nand ability of the client. People with impairments, such\\nas traumatic brain injury or an organic neurological con-\\ndition, may have difficulties with the self-discovery por-\\ntion of the art therapy process depending on their level of\\nfunctioning. However, they may still benefit from art\\ntherapy through the sensory stimulation it provides and\\nthe pleasure they get from artistic creation.\\nWhile art is accessible to all (with or without a ther-\\napist to guide the process), it may be difficult to tap the\\nfull potential of the interpretive part of art therapy with-\\nout a therapist to guide the process. When art therapy is\\nchosen as a therapeutic tool to cope with a physical con-\\ndition, it should be treated as a supplemental therapy and\\nnot as a substitute for conventional medical treatments.\\nResearch and general acceptance\\nA wide body of literature supports the use of art\\ntherapy in a mental health capacity. And as the mind-\\nbody connection between psychological well-being and\\nphysical health is further documented by studies in the\\nfield, art therapy gains greater acceptance by mainstream\\nmedicine as a therapeutic technique for organic illness.\\nResources\\nBOOKS\\nFausek, Diane. A Practical Guide to Art Therapy.Binghamton,\\nNew York: Haworth Press, 1997.\\nGanim, Barbara. Art and Healing: Using expressive art to heal\\nyour body, mind, and spirit. New York: Three Rivers\\nPress, 1999.\\nMalchiodi, Cathy A. The Art Therapy Sourcebook.Los Ange-\\nles: Lowell House, 1998.\\nMcNiff, Shaun. Art as Medicine: Creating a Therapy of the\\nImagination. Boston: Shambhala, 1992.\\nORGANIZATIONS\\nAmerican Art Therapy Association.1202 Allanson Rd.,\\nMundelein, IL 60060-3808. 888-290-0878 or 847-949-\\nKEY TERMS\\nCatharsis —Therapeutic discharge of emotional\\ntension by recalling past events.\\nMandala—A design, usually circular, that appears\\nin religion and art. In Buddhism and Hinduism,\\nthe mandala has religious ritual purposes and\\nserves as a yantra (a geometric emblem or instru-\\nment of contemplation).\\nOrganic illness —A physically, biologically based\\nillness.\\n6064. Fax: 847-566-4580. arttherapy@ntr.net. <http://\\nwww.arttherapy.org>.\\nPaula Ford-Martin\\nAsbestosis\\nDefinition\\nAsbestosis is chronic, progressive inflammation of\\nthe lung. It is not contagious.\\nDescription\\nAsbestosis is a consequence of prolonged exposure\\nto large quantities of asbestos, a material once widely\\nused in construction, insulation, and manufacturing.\\nWhen asbestos is inhaled, fibers penetrate the breathing\\npassages and irritate, fill, inflame, and scar lung tissue. In\\nadvanced asbestosis,, the lungs shrink, stiffen, and\\nbecome honeycombed (riddled with tiny holes).\\nLegislation has reduced use of asbestos in the United\\nStates, but workers who handle automobile brake shoe\\nlinings, boiler insulation, ceiling acoustic tiles, electrical\\nequipment, and fire-resistant materials are still exposed\\nto the substance. Asbestos is used in the production of\\npaints and plastics. Significant amounts can be released\\ninto the atmosphere when old buildings or boats are\\nrazed or remodeled.\\nAsbestosis is most common in men over 40 who\\nhave worked in asbestos-related occupations. Smokers or\\nheavy drinkers have the greatest risk of developing this\\ndisease. Between 1968 and 1992, more than 10,000\\nAmericans over the age of 15 died as a result of asbesto-\\nsis. Nearly 25% of those who died lived in California or\\nGALE ENCYCLOPEDIA OF MEDICINE 2 369\\nAsbestosis\\nGEM - 0001 to 0432 - A  10/22/03 1:43 PM  Page 369')]\n"
     ]
    }
   ],
   "source": [
    "response = rag_chain_with_source.invoke(\"tell me about lucid referal programe?\")\n",
    "print(response['answer'].content)\n",
    "print(response['context'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "%pip install -q rouge bert_score"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/transformers/tokenization_utils_base.py:1617: FutureWarning: `clean_up_tokenization_spaces` was not set. It will be set to `True` by default. This behavior will be deprecated in transformers v4.45, and will be then set to `False` by default. For more details check this issue: https://github.com/huggingface/transformers/issues/31884\n",
      "  warnings.warn(\n",
      "/var/folders/td/g4bcvbr54mn29j_62d0l96c40000gn/T/ipykernel_1664/572360789.py:28: LangChainDeprecationWarning: The method `BaseRetriever.get_relevant_documents` was deprecated in langchain-core 0.1.46 and will be removed in 1.0. Use :meth:`~invoke` instead.\n",
      "  retrieved_docs = retriever.get_relevant_documents(query)[:k]\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Retrieval Evaluation Metrics: {'Precision@k': 0.045759717314487636, 'Recall@k': 0.4575971731448763, 'MRR': 0.12279151943462897}\n",
      "Answer: A brain tumor is an abnormal growth of cells within the brain. It can be benign (non-cancerous) with clear borders and slow growth, or malignant (cancerous) with rapid growth and invasion into surrounding tissues. Brain tumors can cause severe symptoms, including pain and brain damage, and can be life-threatening, especially if located in vital areas.\n",
      "Retrieved Context: [Document(metadata={'page': 582, 'source': './Medical_book.pdf'}, page_content='extension and rarely metastasize (spread) outside the\\nbrain. A benign brain tumor is composed of non-cancer-\\nous cells and does not metastasize beyond the part of the\\nbrain where it originates. A brain tumor is considered\\nmalignant if it contains cancer cells, or if it is composed\\nof harmless cells located in an area where it suppresses\\none or more vital functions.\\nDescription\\nEach year, more than 17,000 brain tumors are diag-\\nnosed in the United States. About half of all primary\\nbrain tumors are benign, but in life-threatening locations.\\nThe rest are malignant and invasive.\\nBenign brain tumors\\nBenign brain tumors, composed of harmless cells,\\nhave clearly defined borders, can usually be completely\\nremoved, and are unlikely to recur. Benign brain tumors\\ndo not infiltrate nearby tissues but can cause severe pain,\\npermanent brain damage, and death. Benign brain\\ntumors sometimes become malignant.\\nMalignant brain tumors\\nMalignant brain tumors do not have distinct borders.\\nThey tend to grow rapidly, increasing pressure within the\\nbrain (IICP) and can spread in the brain or spinal cord\\nbeyond the point where they originate. It is highly unusu-\\nal for malignant brain tumors to spread beyond the cen-\\ntral nervous system (CNS).\\nPrimary brain tumors\\nPrimary brain tumors originate in the brain. They\\nrepresent about 1% of all cancers and 2.5% of all cancer\\ndeaths.\\nMetastatic or secondary brain tumors\\nApproximately 25% of all cancer patients develop\\nsecondary or metastatic brain tumors when cancer cells\\nspread from another part of the body to the brain. Sec-\\nondary brain tumors are most apt to occur in patients\\nwho have:\\n• breast cancer.\\n• colon cancer.\\n• kidney cancer.\\n• lung cancer.\\n• melanoma (cancer) of the skin. These metastatic brain\\ntumors can develop on any part of the brain or spinal\\ncord.\\n• cancer within the nasal passages and/or throat that fol-\\nlow the nerve pathways into the skull, and metastasize\\nto the brain.\\nWho gets brain tumors\\nBrain tumors can develop at any age, but are most\\ncommon in children between the ages of 3-12, and in\\nadults aged 55-65. Primary brain cancer is the second\\nmost common cause of cancer death between birth and\\nthe age of 34, and the fourth most common cause of can-\\ncer death in men aged 35-54. Primary tumors of the brain\\nand central nervous system are often associated with HIV\\ninfection. Men and caucasians have a higher risk of devel-\\noping brain tumors. Other risk factors being studied\\ninclude children with a history of previous radiation treat-\\nment to the head for cancer; parents with certain cancers\\n(nervous system, salivary gland, colon); having an older\\nfather; having well-educated parents; occupational expo-\\nsure to vinyl chloride, lead, and pesticides; history of\\nepilepsy; history of certain genetic conditions (tuberous\\nsclerosis,neurofibromatosis, von Hippel Lindau, famil-\\nial polyposis, Osler-Weber-Rendu, Li-Fraumeni).\\nNaming and grading brain tumors\\nThe name of a brain tumor describes where it origi-\\nnates, how it grows, and what kind of cells it contains. A\\ntumor in an adult is also graded or staged according to:\\n• how malignant it is\\n• how rapidly it is growing and how likely it is to invade\\nother tissues\\n• how closely its cells resemble normal cells. (The more\\nabnormal a tumor cell looks, the faster it is likely to\\ngrow)\\nLow-grade brain tumors usually have well-defined\\nborders. Some low-grade brain tumors form or are\\nenclosed (encapsulated) in cysts. Low-grade brain\\ntumors grow slowly, if at all. They may spread through-\\nout the brain, but rarely metastasize to other parts of the\\nbody.\\nMid-grade and high-grade tumors grow more rapid-\\nly than low-grade tumors. Described as “truly malig-\\nnant,” these tumors usually infiltrate healthy tissue. The\\ngrowth pattern makes it difficult to remove the entire\\ntumor, and these tumors recur more often than low-grade\\ntumors.\\nA single brain tumor can contain several different\\ntypes of cells. The tumor’s grade is determined by the\\nhighest-grade (most malignant) cell detected under a\\nmicroscope, even if most of the cells in the tumor are less\\nmalignant. An infiltrating tumor is a tumor of any grade\\nthat grows into surrounding tissue.\\nGALE ENCYCLOPEDIA OF MEDICINE 2 569\\nBrain tumor\\nGEM -0433 to 0624 - B  10/22/03 6:08 PM  Page 569'), Document(metadata={'page': 582, 'source': '/Users/innovapathinc/Desktop/Gen Ai Topics /Retrieval_eval/ML_GenAI_Concepts/RAG/Data/Medical_book.pdf'}, page_content='extension and rarely metastasize (spread) outside the\\nbrain. A benign brain tumor is composed of non-cancer-\\nous cells and does not metastasize beyond the part of the\\nbrain where it originates. A brain tumor is considered\\nmalignant if it contains cancer cells, or if it is composed\\nof harmless cells located in an area where it suppresses\\none or more vital functions.\\nDescription\\nEach year, more than 17,000 brain tumors are diag-\\nnosed in the United States. About half of all primary\\nbrain tumors are benign, but in life-threatening locations.\\nThe rest are malignant and invasive.\\nBenign brain tumors\\nBenign brain tumors, composed of harmless cells,\\nhave clearly defined borders, can usually be completely\\nremoved, and are unlikely to recur. Benign brain tumors\\ndo not infiltrate nearby tissues but can cause severe pain,\\npermanent brain damage, and death. Benign brain\\ntumors sometimes become malignant.\\nMalignant brain tumors\\nMalignant brain tumors do not have distinct borders.\\nThey tend to grow rapidly, increasing pressure within the\\nbrain (IICP) and can spread in the brain or spinal cord\\nbeyond the point where they originate. It is highly unusu-\\nal for malignant brain tumors to spread beyond the cen-\\ntral nervous system (CNS).\\nPrimary brain tumors\\nPrimary brain tumors originate in the brain. They\\nrepresent about 1% of all cancers and 2.5% of all cancer\\ndeaths.\\nMetastatic or secondary brain tumors\\nApproximately 25% of all cancer patients develop\\nsecondary or metastatic brain tumors when cancer cells\\nspread from another part of the body to the brain. Sec-\\nondary brain tumors are most apt to occur in patients\\nwho have:\\n• breast cancer.\\n• colon cancer.\\n• kidney cancer.\\n• lung cancer.\\n• melanoma (cancer) of the skin. These metastatic brain\\ntumors can develop on any part of the brain or spinal\\ncord.\\n• cancer within the nasal passages and/or throat that fol-\\nlow the nerve pathways into the skull, and metastasize\\nto the brain.\\nWho gets brain tumors\\nBrain tumors can develop at any age, but are most\\ncommon in children between the ages of 3-12, and in\\nadults aged 55-65. Primary brain cancer is the second\\nmost common cause of cancer death between birth and\\nthe age of 34, and the fourth most common cause of can-\\ncer death in men aged 35-54. Primary tumors of the brain\\nand central nervous system are often associated with HIV\\ninfection. Men and caucasians have a higher risk of devel-\\noping brain tumors. Other risk factors being studied\\ninclude children with a history of previous radiation treat-\\nment to the head for cancer; parents with certain cancers\\n(nervous system, salivary gland, colon); having an older\\nfather; having well-educated parents; occupational expo-\\nsure to vinyl chloride, lead, and pesticides; history of\\nepilepsy; history of certain genetic conditions (tuberous\\nsclerosis,neurofibromatosis, von Hippel Lindau, famil-\\nial polyposis, Osler-Weber-Rendu, Li-Fraumeni).\\nNaming and grading brain tumors\\nThe name of a brain tumor describes where it origi-\\nnates, how it grows, and what kind of cells it contains. A\\ntumor in an adult is also graded or staged according to:\\n• how malignant it is\\n• how rapidly it is growing and how likely it is to invade\\nother tissues\\n• how closely its cells resemble normal cells. (The more\\nabnormal a tumor cell looks, the faster it is likely to\\ngrow)\\nLow-grade brain tumors usually have well-defined\\nborders. Some low-grade brain tumors form or are\\nenclosed (encapsulated) in cysts. Low-grade brain\\ntumors grow slowly, if at all. They may spread through-\\nout the brain, but rarely metastasize to other parts of the\\nbody.\\nMid-grade and high-grade tumors grow more rapid-\\nly than low-grade tumors. Described as “truly malig-\\nnant,” these tumors usually infiltrate healthy tissue. The\\ngrowth pattern makes it difficult to remove the entire\\ntumor, and these tumors recur more often than low-grade\\ntumors.\\nA single brain tumor can contain several different\\ntypes of cells. The tumor’s grade is determined by the\\nhighest-grade (most malignant) cell detected under a\\nmicroscope, even if most of the cells in the tumor are less\\nmalignant. An infiltrating tumor is a tumor of any grade\\nthat grows into surrounding tissue.\\nGALE ENCYCLOPEDIA OF MEDICINE 2 569\\nBrain tumor\\nGEM -0433 to 0624 - B  10/22/03 6:08 PM  Page 569'), Document(metadata={'page': 582, 'source': '/Users/innovapathinc/Desktop/Gen Ai Topics /Retrieval_eval/ML_GenAI_Concepts/RAG/Data/Medical_book.pdf'}, page_content='extension and rarely metastasize (spread) outside the\\nbrain. A benign brain tumor is composed of non-cancer-\\nous cells and does not metastasize beyond the part of the\\nbrain where it originates. A brain tumor is considered\\nmalignant if it contains cancer cells, or if it is composed\\nof harmless cells located in an area where it suppresses\\none or more vital functions.\\nDescription\\nEach year, more than 17,000 brain tumors are diag-\\nnosed in the United States. About half of all primary\\nbrain tumors are benign, but in life-threatening locations.\\nThe rest are malignant and invasive.\\nBenign brain tumors\\nBenign brain tumors, composed of harmless cells,\\nhave clearly defined borders, can usually be completely\\nremoved, and are unlikely to recur. Benign brain tumors\\ndo not infiltrate nearby tissues but can cause severe pain,\\npermanent brain damage, and death. Benign brain\\ntumors sometimes become malignant.\\nMalignant brain tumors\\nMalignant brain tumors do not have distinct borders.\\nThey tend to grow rapidly, increasing pressure within the\\nbrain (IICP) and can spread in the brain or spinal cord\\nbeyond the point where they originate. It is highly unusu-\\nal for malignant brain tumors to spread beyond the cen-\\ntral nervous system (CNS).\\nPrimary brain tumors\\nPrimary brain tumors originate in the brain. They\\nrepresent about 1% of all cancers and 2.5% of all cancer\\ndeaths.\\nMetastatic or secondary brain tumors\\nApproximately 25% of all cancer patients develop\\nsecondary or metastatic brain tumors when cancer cells\\nspread from another part of the body to the brain. Sec-\\nondary brain tumors are most apt to occur in patients\\nwho have:\\n• breast cancer.\\n• colon cancer.\\n• kidney cancer.\\n• lung cancer.\\n• melanoma (cancer) of the skin. These metastatic brain\\ntumors can develop on any part of the brain or spinal\\ncord.\\n• cancer within the nasal passages and/or throat that fol-\\nlow the nerve pathways into the skull, and metastasize\\nto the brain.\\nWho gets brain tumors\\nBrain tumors can develop at any age, but are most\\ncommon in children between the ages of 3-12, and in\\nadults aged 55-65. Primary brain cancer is the second\\nmost common cause of cancer death between birth and\\nthe age of 34, and the fourth most common cause of can-\\ncer death in men aged 35-54. Primary tumors of the brain\\nand central nervous system are often associated with HIV\\ninfection. Men and caucasians have a higher risk of devel-\\noping brain tumors. Other risk factors being studied\\ninclude children with a history of previous radiation treat-\\nment to the head for cancer; parents with certain cancers\\n(nervous system, salivary gland, colon); having an older\\nfather; having well-educated parents; occupational expo-\\nsure to vinyl chloride, lead, and pesticides; history of\\nepilepsy; history of certain genetic conditions (tuberous\\nsclerosis,neurofibromatosis, von Hippel Lindau, famil-\\nial polyposis, Osler-Weber-Rendu, Li-Fraumeni).\\nNaming and grading brain tumors\\nThe name of a brain tumor describes where it origi-\\nnates, how it grows, and what kind of cells it contains. A\\ntumor in an adult is also graded or staged according to:\\n• how malignant it is\\n• how rapidly it is growing and how likely it is to invade\\nother tissues\\n• how closely its cells resemble normal cells. (The more\\nabnormal a tumor cell looks, the faster it is likely to\\ngrow)\\nLow-grade brain tumors usually have well-defined\\nborders. Some low-grade brain tumors form or are\\nenclosed (encapsulated) in cysts. Low-grade brain\\ntumors grow slowly, if at all. They may spread through-\\nout the brain, but rarely metastasize to other parts of the\\nbody.\\nMid-grade and high-grade tumors grow more rapid-\\nly than low-grade tumors. Described as “truly malig-\\nnant,” these tumors usually infiltrate healthy tissue. The\\ngrowth pattern makes it difficult to remove the entire\\ntumor, and these tumors recur more often than low-grade\\ntumors.\\nA single brain tumor can contain several different\\ntypes of cells. The tumor’s grade is determined by the\\nhighest-grade (most malignant) cell detected under a\\nmicroscope, even if most of the cells in the tumor are less\\nmalignant. An infiltrating tumor is a tumor of any grade\\nthat grows into surrounding tissue.\\nGALE ENCYCLOPEDIA OF MEDICINE 2 569\\nBrain tumor\\nGEM -0433 to 0624 - B  10/22/03 6:08 PM  Page 569'), Document(metadata={'page': 582, 'source': '/Users/innovapathinc/Desktop/Gen Ai Topics /Retrieval_eval/ML_GenAI_Concepts/RAG/Data/Medical_book.pdf'}, page_content='extension and rarely metastasize (spread) outside the\\nbrain. A benign brain tumor is composed of non-cancer-\\nous cells and does not metastasize beyond the part of the\\nbrain where it originates. A brain tumor is considered\\nmalignant if it contains cancer cells, or if it is composed\\nof harmless cells located in an area where it suppresses\\none or more vital functions.\\nDescription\\nEach year, more than 17,000 brain tumors are diag-\\nnosed in the United States. About half of all primary\\nbrain tumors are benign, but in life-threatening locations.\\nThe rest are malignant and invasive.\\nBenign brain tumors\\nBenign brain tumors, composed of harmless cells,\\nhave clearly defined borders, can usually be completely\\nremoved, and are unlikely to recur. Benign brain tumors\\ndo not infiltrate nearby tissues but can cause severe pain,\\npermanent brain damage, and death. Benign brain\\ntumors sometimes become malignant.\\nMalignant brain tumors\\nMalignant brain tumors do not have distinct borders.\\nThey tend to grow rapidly, increasing pressure within the\\nbrain (IICP) and can spread in the brain or spinal cord\\nbeyond the point where they originate. It is highly unusu-\\nal for malignant brain tumors to spread beyond the cen-\\ntral nervous system (CNS).\\nPrimary brain tumors\\nPrimary brain tumors originate in the brain. They\\nrepresent about 1% of all cancers and 2.5% of all cancer\\ndeaths.\\nMetastatic or secondary brain tumors\\nApproximately 25% of all cancer patients develop\\nsecondary or metastatic brain tumors when cancer cells\\nspread from another part of the body to the brain. Sec-\\nondary brain tumors are most apt to occur in patients\\nwho have:\\n• breast cancer.\\n• colon cancer.\\n• kidney cancer.\\n• lung cancer.\\n• melanoma (cancer) of the skin. These metastatic brain\\ntumors can develop on any part of the brain or spinal\\ncord.\\n• cancer within the nasal passages and/or throat that fol-\\nlow the nerve pathways into the skull, and metastasize\\nto the brain.\\nWho gets brain tumors\\nBrain tumors can develop at any age, but are most\\ncommon in children between the ages of 3-12, and in\\nadults aged 55-65. Primary brain cancer is the second\\nmost common cause of cancer death between birth and\\nthe age of 34, and the fourth most common cause of can-\\ncer death in men aged 35-54. Primary tumors of the brain\\nand central nervous system are often associated with HIV\\ninfection. Men and caucasians have a higher risk of devel-\\noping brain tumors. Other risk factors being studied\\ninclude children with a history of previous radiation treat-\\nment to the head for cancer; parents with certain cancers\\n(nervous system, salivary gland, colon); having an older\\nfather; having well-educated parents; occupational expo-\\nsure to vinyl chloride, lead, and pesticides; history of\\nepilepsy; history of certain genetic conditions (tuberous\\nsclerosis,neurofibromatosis, von Hippel Lindau, famil-\\nial polyposis, Osler-Weber-Rendu, Li-Fraumeni).\\nNaming and grading brain tumors\\nThe name of a brain tumor describes where it origi-\\nnates, how it grows, and what kind of cells it contains. A\\ntumor in an adult is also graded or staged according to:\\n• how malignant it is\\n• how rapidly it is growing and how likely it is to invade\\nother tissues\\n• how closely its cells resemble normal cells. (The more\\nabnormal a tumor cell looks, the faster it is likely to\\ngrow)\\nLow-grade brain tumors usually have well-defined\\nborders. Some low-grade brain tumors form or are\\nenclosed (encapsulated) in cysts. Low-grade brain\\ntumors grow slowly, if at all. They may spread through-\\nout the brain, but rarely metastasize to other parts of the\\nbody.\\nMid-grade and high-grade tumors grow more rapid-\\nly than low-grade tumors. Described as “truly malig-\\nnant,” these tumors usually infiltrate healthy tissue. The\\ngrowth pattern makes it difficult to remove the entire\\ntumor, and these tumors recur more often than low-grade\\ntumors.\\nA single brain tumor can contain several different\\ntypes of cells. The tumor’s grade is determined by the\\nhighest-grade (most malignant) cell detected under a\\nmicroscope, even if most of the cells in the tumor are less\\nmalignant. An infiltrating tumor is a tumor of any grade\\nthat grows into surrounding tissue.\\nGALE ENCYCLOPEDIA OF MEDICINE 2 569\\nBrain tumor\\nGEM -0433 to 0624 - B  10/22/03 6:08 PM  Page 569')]\n"
     ]
    }
   ],
   "source": [
    "import json\n",
    "from langchain_core.runnables import RunnablePassthrough, RunnableMap\n",
    "from langchain.embeddings import HuggingFaceEmbeddings\n",
    "from langchain.vectorstores import Chroma\n",
    "from langchain.text_splitter import CharacterTextSplitter\n",
    "from langchain_community.document_loaders import PyPDFLoader\n",
    "from langchain.embeddings.cache import CacheBackedEmbeddings\n",
    "from langchain.storage import LocalFileStore\n",
    "from langchain_core.prompts import ChatPromptTemplate\n",
    "from langchain_mistralai import ChatMistralAI\n",
    "from langchain_core.runnables import RunnableParallel\n",
    "\n",
    "# Load the dataset for evaluation\n",
    "with open(\"/Users/innovapathinc/Desktop/Gen Ai Topics /Retrieval_eval/ML_GenAI_Concepts/RAG/medical_dataset.json\", \"r\") as f:\n",
    "    ground_truth = json.load(f)\n",
    "\n",
    "# Function to calculate evaluation metrics\n",
    "def evaluate_retrieval(retriever, ground_truth, k=10):\n",
    "    precision_list = []\n",
    "    recall_list = []\n",
    "    reciprocal_ranks = []\n",
    "\n",
    "    for item in ground_truth:\n",
    "        query = item[\"query\"]\n",
    "        ground_truth_doc = item[\"ground_truth_document\"]\n",
    "\n",
    "        # Retrieve top-k documents\n",
    "        retrieved_docs = retriever.get_relevant_documents(query)[:k]\n",
    "\n",
    "        # Extract content for comparison\n",
    "        retrieved_content = [doc.page_content for doc in retrieved_docs]\n",
    "\n",
    "        # Precision@k\n",
    "        relevant_retrieved = sum(1 for doc in retrieved_content if ground_truth_doc in doc)\n",
    "        precision = relevant_retrieved / k\n",
    "        precision_list.append(precision)\n",
    "\n",
    "        # Recall@k\n",
    "        total_relevant = 1  # Assuming one ground truth document\n",
    "        recall = relevant_retrieved / total_relevant\n",
    "        recall_list.append(recall)\n",
    "\n",
    "        # Mean Reciprocal Rank (MRR)\n",
    "        try:\n",
    "            rank = next(i + 1 for i, doc in enumerate(retrieved_content) if ground_truth_doc in doc)\n",
    "            reciprocal_ranks.append(1 / rank)\n",
    "        except StopIteration:\n",
    "            reciprocal_ranks.append(0)\n",
    "\n",
    "    # Calculate averages\n",
    "    precision_avg = sum(precision_list) / len(precision_list)\n",
    "    recall_avg = sum(recall_list) / len(recall_list)\n",
    "    mrr = sum(reciprocal_ranks) / len(reciprocal_ranks)\n",
    "\n",
    "    return {\n",
    "        \"Precision@k\": precision_avg,\n",
    "        \"Recall@k\": recall_avg,\n",
    "        \"MRR\": mrr\n",
    "    }\n",
    "\n",
    "# Load and preprocess documents\n",
    "loader = PyPDFLoader(\"/Users/innovapathinc/Desktop/Gen Ai Topics /Retrieval_eval/ML_GenAI_Concepts/RAG/Data/Medical_book.pdf\")\n",
    "docs = loader.load()\n",
    "text_splitter = CharacterTextSplitter(\n",
    "    separator=\"\\n\\n\", chunk_size=500, chunk_overlap=150, is_separator_regex=False\n",
    ")\n",
    "chunks = text_splitter.split_documents(docs)\n",
    "\n",
    "# Setup embeddings and retriever\n",
    "store = LocalFileStore(\"./cache/\")\n",
    "core_embeddings_model = HuggingFaceEmbeddings(model_name=\"sentence-transformers/all-MiniLM-L6-v2\")\n",
    "embedder = CacheBackedEmbeddings.from_bytes_store(core_embeddings_model, store)\n",
    "vectorstore = Chroma.from_documents(chunks, embedder, persist_directory=\"./chroma_store\")\n",
    "retriever = vectorstore.as_retriever()\n",
    "\n",
    "# Define prompt and LLM\n",
    "prompt = \"\"\"You are an assistant for question-answering tasks.\n",
    "Use the following pieces of retrieved context to answer the question.\n",
    "If you don't know the answer, just say that you don't know.\n",
    "Use three sentences maximum and keep the answer concise.\n",
    "\n",
    "Question: {question}\n",
    "\n",
    "Context: {context}\n",
    "\n",
    "Answer:\n",
    "\"\"\"\n",
    "prompt_template = ChatPromptTemplate.from_template(prompt)\n",
    "llm = ChatMistralAI(model=\"mistral-large-latest\", streaming=True, api_key=api_key)\n",
    "\n",
    "# RAG chain\n",
    "rag_chain_from_docs = (\n",
    "    RunnablePassthrough.assign(context=(lambda x: \"\\n\\n\".join(doc.page_content for doc in x[\"context\"])))\n",
    "    | prompt_template\n",
    "    | llm\n",
    ")\n",
    "rag_chain_with_source = RunnableParallel(\n",
    "    {\"context\": retriever, \"question\": RunnablePassthrough()}\n",
    ").assign(answer=rag_chain_from_docs)\n",
    "\n",
    "# Evaluate the retriever\n",
    "evaluation_metrics = evaluate_retrieval(retriever, ground_truth, k=10)\n",
    "print(\"Retrieval Evaluation Metrics:\", evaluation_metrics)\n",
    "\n",
    "# Run a query\n",
    "response = rag_chain_with_source.invoke(\"explain about brain tumour\")\n",
    "print(\"Answer:\", response[\"answer\"].content)\n",
    "print(\"Retrieved Context:\", response[\"context\"])\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "{'Average BLEU Score': 0.1304316792244985, 'Average ROUGE Score': {'rouge-1': {'f': 0.6333333283333334, 'p': 0.6333333333333333, 'r': 0.6333333333333333}, 'rouge-2': {'f': 0.12499999750000004, 'p': 0.125, 'r': 0.125}, 'rouge-l': {'f': 0.6333333283333334, 'p': 0.6333333333333333, 'r': 0.6333333333333333}}}\n",
      "Answer: A brain tumor is an abnormal growth of cells within the brain. It can be benign (non-cancerous) with clear borders and slow growth, or malignant (cancerous) with rapid growth and invasion into surrounding tissues. Brain tumors can cause severe symptoms, including pain and brain damage, and can be life-threatening, especially if located in vital areas.\n"
     ]
    }
   ],
   "source": [
    "from nltk.translate.bleu_score import sentence_bleu, SmoothingFunction\n",
    "from rouge import Rouge\n",
    "\n",
    "def evaluate_bleu_rouge(responses, ground_truths):\n",
    "    \"\"\"\n",
    "    Evaluate LLM-generated responses using BLEU and ROUGE scores.\n",
    "\n",
    "    Args:\n",
    "        responses (list of str): List of responses generated by the LLM.\n",
    "        ground_truths (list of str): List of ground truth answers.\n",
    "\n",
    "    Returns:\n",
    "        dict: A dictionary containing BLEU and ROUGE scores.\n",
    "    \"\"\"\n",
    "    assert len(responses) == len(ground_truths), \"Responses and ground truths must have the same length.\"\n",
    "\n",
    "    # Initialize scores\n",
    "    total_bleu_score = 0\n",
    "    rouge = Rouge()\n",
    "    rouge_scores = []\n",
    "\n",
    "    # Evaluate each response\n",
    "    for response, ground_truth in zip(responses, ground_truths):\n",
    "        # Compute BLEU score\n",
    "        bleu_score = sentence_bleu(\n",
    "            [ground_truth.split()], response.split(),\n",
    "            smoothing_function=SmoothingFunction().method1\n",
    "        )\n",
    "        total_bleu_score += bleu_score\n",
    "\n",
    "        # Compute ROUGE scores\n",
    "        rouge_score = rouge.get_scores(response, ground_truth, avg=True)\n",
    "        rouge_scores.append(rouge_score)\n",
    "\n",
    "    # Average BLEU score \n",
    "    avg_bleu_score = total_bleu_score / len(responses)\n",
    "\n",
    "    # Average ROUGE scores\n",
    "    avg_rouge_score = {\n",
    "        \"rouge-1\": {\n",
    "            \"f\": sum(score[\"rouge-1\"][\"f\"] for score in rouge_scores) / len(rouge_scores),\n",
    "            \"p\": sum(score[\"rouge-1\"][\"p\"] for score in rouge_scores) / len(rouge_scores),\n",
    "            \"r\": sum(score[\"rouge-1\"][\"r\"] for score in rouge_scores) / len(rouge_scores),\n",
    "        },\n",
    "        \"rouge-2\": {\n",
    "            \"f\": sum(score[\"rouge-2\"][\"f\"] for score in rouge_scores) / len(rouge_scores),\n",
    "            \"p\": sum(score[\"rouge-2\"][\"p\"] for score in rouge_scores) / len(rouge_scores),\n",
    "            \"r\": sum(score[\"rouge-2\"][\"r\"] for score in rouge_scores) / len(rouge_scores),\n",
    "        },\n",
    "        \"rouge-l\": {\n",
    "            \"f\": sum(score[\"rouge-l\"][\"f\"] for score in rouge_scores) / len(rouge_scores),\n",
    "            \"p\": sum(score[\"rouge-l\"][\"p\"] for score in rouge_scores) / len(rouge_scores),\n",
    "            \"r\": sum(score[\"rouge-l\"][\"r\"] for score in rouge_scores) / len(rouge_scores),\n",
    "        },\n",
    "    }\n",
    "\n",
    "    return {\n",
    "        \"Average BLEU Score\": avg_bleu_score,\n",
    "        \"Average ROUGE Score\": avg_rouge_score,\n",
    "    }\n",
    "\n",
    "# Example usage\n",
    "responses = [\n",
    "    \"This is a generated response.\",\n",
    "    \"Another generated response.\"\n",
    "]\n",
    "ground_truths = [\n",
    "    \"This is the expected response.\",\n",
    "    \"Another correct response.\"\n",
    "]\n",
    "\n",
    "scores = evaluate_bleu_rouge(responses, ground_truths)\n",
    "print(scores)\n",
    "print(\"Answer:\", response[\"answer\"].content)"
   ]
  }
 ],
 "metadata": {
  "colab": {
   "provenance": []
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 0
}
